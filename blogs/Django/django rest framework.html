<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>引入Django REST framework | 蔡豪的个人博客 | 资源站</title>
    <meta name="generator" content="VuePress 1.8.2">
    <script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?2f39d4ae56c0a205004d3e19e862568d";var s = document.getElementsByTagName("script")[0];s.parentNode.insertBefore(hm, s);})();</script>
    <meta name="description" content="第一个vue博客">
    
    <link rel="preload" href="/assets/css/0.styles.cb8799d3.css" as="style"><link rel="preload" href="/assets/js/app.d3bb4dbb.js" as="script"><link rel="preload" href="/assets/js/2.e4f42491.js" as="script"><link rel="preload" href="/assets/js/13.6388755d.js" as="script"><link rel="prefetch" href="/assets/js/10.85ca922b.js"><link rel="prefetch" href="/assets/js/11.9dba0de1.js"><link rel="prefetch" href="/assets/js/12.37ac5ffb.js"><link rel="prefetch" href="/assets/js/14.c8427d84.js"><link rel="prefetch" href="/assets/js/15.66e26a97.js"><link rel="prefetch" href="/assets/js/16.3acdc13b.js"><link rel="prefetch" href="/assets/js/17.4aeccfd1.js"><link rel="prefetch" href="/assets/js/18.907f2642.js"><link rel="prefetch" href="/assets/js/19.4b227bef.js"><link rel="prefetch" href="/assets/js/20.d43c29e9.js"><link rel="prefetch" href="/assets/js/21.5a9963a4.js"><link rel="prefetch" href="/assets/js/22.78c7d942.js"><link rel="prefetch" href="/assets/js/23.bc7213ff.js"><link rel="prefetch" href="/assets/js/24.a1f72da8.js"><link rel="prefetch" href="/assets/js/25.e292862c.js"><link rel="prefetch" href="/assets/js/26.0bb2f89b.js"><link rel="prefetch" href="/assets/js/27.6f8d846a.js"><link rel="prefetch" href="/assets/js/28.3a14cf34.js"><link rel="prefetch" href="/assets/js/29.0446de4e.js"><link rel="prefetch" href="/assets/js/3.f5c64aa6.js"><link rel="prefetch" href="/assets/js/30.bd0e7a54.js"><link rel="prefetch" href="/assets/js/31.7b0b5ca0.js"><link rel="prefetch" href="/assets/js/32.504e8e06.js"><link rel="prefetch" href="/assets/js/33.ba84da0b.js"><link rel="prefetch" href="/assets/js/34.d29753a8.js"><link rel="prefetch" href="/assets/js/35.cdb6cedf.js"><link rel="prefetch" href="/assets/js/36.2615aa70.js"><link rel="prefetch" href="/assets/js/37.0994e0e9.js"><link rel="prefetch" href="/assets/js/38.b6ef21ca.js"><link rel="prefetch" href="/assets/js/39.708932a1.js"><link rel="prefetch" href="/assets/js/4.6542382f.js"><link rel="prefetch" href="/assets/js/40.d93e2725.js"><link rel="prefetch" href="/assets/js/41.9bb06d64.js"><link rel="prefetch" href="/assets/js/5.0eb0af7d.js"><link rel="prefetch" href="/assets/js/6.a6810715.js"><link rel="prefetch" href="/assets/js/7.14a78bd7.js"><link rel="prefetch" href="/assets/js/8.a88c782f.js"><link rel="prefetch" href="/assets/js/9.386906af.js">
    <link rel="stylesheet" href="/assets/css/0.styles.cb8799d3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/image/home.png" alt="蔡豪的个人博客 | 资源站" class="logo"> <span class="site-name can-hide">蔡豪的个人博客 | 资源站</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/errolog/" class="nav-link">
  踩坑集锦
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="笔记" class="dropdown-title"><span class="title">笔记</span> <span class="arrow down"></span></button> <button type="button" aria-label="笔记" class="mobile-dropdown-title"><span class="title">笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blogs/Django/.html" class="nav-link">
  计算机基础
</a></li><li class="dropdown-item"><!----> <a href="/blogs/数据结构与算法/" class="nav-link">
  数据结构与算法
</a></li><li class="dropdown-item"><h4>
          前端
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blogs/javascript/JavaScript核心语法.html" class="nav-link">
  javascript
</a></li><li class="dropdown-subitem"><a href="/blogs/jquery/" class="nav-link">
  jquery
</a></li><li class="dropdown-subitem"><a href="/blogs/vue/vue.html" class="nav-link">
  vue
</a></li></ul></li><li class="dropdown-item"><h4>
          后端
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blogs/python/" class="nav-link">
  python
</a></li><li class="dropdown-subitem"><a href="/blogs/Django/" class="nav-link router-link-active">
  Django
</a></li></ul></li><li class="dropdown-item"><h4>
          服务器
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blogs/nginx/" class="nav-link">
  nginx
</a></li><li class="dropdown-subitem"><a href="/blogs/linux/" class="nav-link">
  linux
</a></li></ul></li><li class="dropdown-item"><h4>
          数据库
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blogs/数据库/Mysql.html" class="nav-link">
  Mysql
</a></li><li class="dropdown-subitem"><a href="/blogs/数据库/redis.html" class="nav-link">
  redis
</a></li></ul></li><li class="dropdown-item"><h4>
          工具
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blogs/markdown/" class="nav-link">
  markdown
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="http://www.xroot.top" target="_blank" rel="noopener noreferrer" class="nav-link external">
  个人实战网站
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="/tools/" class="nav-link">
  脚本
</a></div><div class="nav-item"><a href="/resource/" class="nav-link">
  资源
</a></div><div class="nav-item"><a href="/course/" class="nav-link">
  教程
</a></div><div class="nav-item"><a href="/games/" class="nav-link">
  游戏
</a></div><div class="nav-item"><a href="https://github.com/Grnetsky" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://gitee.com/CaihaoX" target="_blank" rel="noopener noreferrer" class="nav-link external">
  gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/errolog/" class="nav-link">
  踩坑集锦
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="笔记" class="dropdown-title"><span class="title">笔记</span> <span class="arrow down"></span></button> <button type="button" aria-label="笔记" class="mobile-dropdown-title"><span class="title">笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blogs/Django/.html" class="nav-link">
  计算机基础
</a></li><li class="dropdown-item"><!----> <a href="/blogs/数据结构与算法/" class="nav-link">
  数据结构与算法
</a></li><li class="dropdown-item"><h4>
          前端
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blogs/javascript/JavaScript核心语法.html" class="nav-link">
  javascript
</a></li><li class="dropdown-subitem"><a href="/blogs/jquery/" class="nav-link">
  jquery
</a></li><li class="dropdown-subitem"><a href="/blogs/vue/vue.html" class="nav-link">
  vue
</a></li></ul></li><li class="dropdown-item"><h4>
          后端
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blogs/python/" class="nav-link">
  python
</a></li><li class="dropdown-subitem"><a href="/blogs/Django/" class="nav-link router-link-active">
  Django
</a></li></ul></li><li class="dropdown-item"><h4>
          服务器
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blogs/nginx/" class="nav-link">
  nginx
</a></li><li class="dropdown-subitem"><a href="/blogs/linux/" class="nav-link">
  linux
</a></li></ul></li><li class="dropdown-item"><h4>
          数据库
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blogs/数据库/Mysql.html" class="nav-link">
  Mysql
</a></li><li class="dropdown-subitem"><a href="/blogs/数据库/redis.html" class="nav-link">
  redis
</a></li></ul></li><li class="dropdown-item"><h4>
          工具
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blogs/markdown/" class="nav-link">
  markdown
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="http://www.xroot.top" target="_blank" rel="noopener noreferrer" class="nav-link external">
  个人实战网站
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="/tools/" class="nav-link">
  脚本
</a></div><div class="nav-item"><a href="/resource/" class="nav-link">
  资源
</a></div><div class="nav-item"><a href="/course/" class="nav-link">
  教程
</a></div><div class="nav-item"><a href="/games/" class="nav-link">
  游戏
</a></div><div class="nav-item"><a href="https://github.com/Grnetsky" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://gitee.com/CaihaoX" target="_blank" rel="noopener noreferrer" class="nav-link external">
  gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/blogs/Django/" aria-current="page" class="sidebar-link">django</a></li><li><a href="/blogs/Django/django rest framework.html" class="active sidebar-link">引入Django REST framework</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blogs/Django/django rest framework.html#_1-前后端不分离" class="sidebar-link">1 前后端不分离</a></li><li class="sidebar-sub-header"><a href="/blogs/Django/django rest framework.html#_2-前后端分离" class="sidebar-link">2 前后端分离</a></li><li class="sidebar-sub-header"><a href="/blogs/Django/django rest framework.html#起源" class="sidebar-link">起源</a></li><li class="sidebar-sub-header"><a href="/blogs/Django/django rest framework.html#说明" class="sidebar-link">说明</a></li><li class="sidebar-sub-header"><a href="/blogs/Django/django rest framework.html#_1-域名" class="sidebar-link">1. 域名</a></li><li class="sidebar-sub-header"><a href="/blogs/Django/django rest framework.html#_2-版本-versioning" class="sidebar-link">2. 版本（Versioning）</a></li><li class="sidebar-sub-header"><a href="/blogs/Django/django rest framework.html#_3-路径-endpoint" class="sidebar-link">3. 路径（Endpoint）</a></li><li class="sidebar-sub-header"><a href="/blogs/Django/django rest framework.html#_3-http动词" class="sidebar-link">3. HTTP动词</a></li><li class="sidebar-sub-header"><a href="/blogs/Django/django rest framework.html#_4-过滤信息-filtering" class="sidebar-link">4. 过滤信息（Filtering）</a></li><li class="sidebar-sub-header"><a href="/blogs/Django/django rest framework.html#_6-状态码-status-codes" class="sidebar-link">6. 状态码（Status Codes）</a></li><li class="sidebar-sub-header"><a href="/blogs/Django/django rest framework.html#_7-错误处理-error-handling" class="sidebar-link">7. 错误处理（Error handling）</a></li><li class="sidebar-sub-header"><a href="/blogs/Django/django rest framework.html#_8-返回结果" class="sidebar-link">8. 返回结果</a></li><li class="sidebar-sub-header"><a href="/blogs/Django/django rest framework.html#_9-超媒体-hypermedia-api" class="sidebar-link">9. 超媒体（Hypermedia API）</a></li><li class="sidebar-sub-header"><a href="/blogs/Django/django rest framework.html#_10-其他" class="sidebar-link">10. 其他</a></li><li class="sidebar-sub-header"><a href="/blogs/Django/django rest framework.html#序列化serialization" class="sidebar-link">序列化Serialization</a></li><li class="sidebar-sub-header"><a href="/blogs/Django/django rest framework.html#总结" class="sidebar-link">总结</a></li><li class="sidebar-sub-header"><a href="/blogs/Django/django rest framework.html#认识django-rest-framework" class="sidebar-link">认识Django REST framework</a></li><li class="sidebar-sub-header"><a href="/blogs/Django/django rest framework.html#_1-安装drf" class="sidebar-link">1. 安装DRF</a></li><li class="sidebar-sub-header"><a href="/blogs/Django/django rest framework.html#_2-添加rest-framework应用" class="sidebar-link">2. 添加rest_framework应用</a></li><li class="sidebar-sub-header"><a href="/blogs/Django/django rest framework.html#_1-创建序列化器" class="sidebar-link">1. 创建序列化器</a></li><li class="sidebar-sub-header"><a href="/blogs/Django/django rest framework.html#_2-编写视图" class="sidebar-link">2. 编写视图</a></li><li class="sidebar-sub-header"><a href="/blogs/Django/django rest framework.html#_3-定义路由" class="sidebar-link">3. 定义路由</a></li><li class="sidebar-sub-header"><a href="/blogs/Django/django rest framework.html#_4-运行测试" class="sidebar-link">4. 运行测试</a></li><li class="sidebar-sub-header"><a href="/blogs/Django/django rest framework.html#_1-基本使用" class="sidebar-link">1 基本使用</a></li><li class="sidebar-sub-header"><a href="/blogs/Django/django rest framework.html#_2-关联对象嵌套序列化" class="sidebar-link">2 关联对象嵌套序列化</a></li><li class="sidebar-sub-header"><a href="/blogs/Django/django rest framework.html#_3-many参数" class="sidebar-link">3 many参数</a></li><li class="sidebar-sub-header"><a href="/blogs/Django/django rest framework.html#_1-验证" class="sidebar-link">1. 验证</a></li><li class="sidebar-sub-header"><a href="/blogs/Django/django rest framework.html#_2-保存" class="sidebar-link">2. 保存</a></li><li class="sidebar-sub-header"><a href="/blogs/Django/django rest framework.html#_1-定义" class="sidebar-link">1. 定义</a></li><li class="sidebar-sub-header"><a href="/blogs/Django/django rest framework.html#_2-指定字段" class="sidebar-link">2. 指定字段</a></li><li class="sidebar-sub-header"><a href="/blogs/Django/django rest framework.html#_3-添加额外参数" class="sidebar-link">3. 添加额外参数</a></li><li class="sidebar-sub-header"><a href="/blogs/Django/django rest framework.html#_1-request" class="sidebar-link">1. Request</a></li><li class="sidebar-sub-header"><a href="/blogs/Django/django rest framework.html#_2-response" class="sidebar-link">2. Response</a></li><li class="sidebar-sub-header"><a href="/blogs/Django/django rest framework.html#_3-状态码" class="sidebar-link">3. 状态码</a></li><li class="sidebar-sub-header"><a href="/blogs/Django/django rest framework.html#_1-两个基类" class="sidebar-link">1. 两个基类</a></li><li class="sidebar-sub-header"><a href="/blogs/Django/django rest framework.html#_2-五个扩展类" class="sidebar-link">2. 五个扩展类</a></li><li class="sidebar-sub-header"><a href="/blogs/Django/django rest framework.html#_3-几个可用子类视图" class="sidebar-link">3. 几个可用子类视图</a></li><li class="sidebar-sub-header"><a href="/blogs/Django/django rest framework.html#_1-常用视图集父类" class="sidebar-link">1. 常用视图集父类</a></li><li class="sidebar-sub-header"><a href="/blogs/Django/django rest framework.html#_2-视图集中定义附加action动作" class="sidebar-link">2. 视图集中定义附加action动作</a></li><li class="sidebar-sub-header"><a href="/blogs/Django/django rest framework.html#_3-action属性" class="sidebar-link">3. action属性</a></li><li class="sidebar-sub-header"><a href="/blogs/Django/django rest framework.html#_4-视图集的继承关系" class="sidebar-link">4. 视图集的继承关系</a></li><li class="sidebar-sub-header"><a href="/blogs/Django/django rest framework.html#_1-使用方法" class="sidebar-link">1. 使用方法</a></li><li class="sidebar-sub-header"><a href="/blogs/Django/django rest framework.html#_2-视图集中附加action的声明" class="sidebar-link">2. 视图集中附加action的声明</a></li><li class="sidebar-sub-header"><a href="/blogs/Django/django rest framework.html#使用-2" class="sidebar-link">使用</a></li><li class="sidebar-sub-header"><a href="/blogs/Django/django rest framework.html#实例" class="sidebar-link">实例</a></li><li class="sidebar-sub-header"><a href="/blogs/Django/django rest framework.html#可选分页器" class="sidebar-link">可选分页器</a></li><li class="sidebar-sub-header"><a href="/blogs/Django/django rest framework.html#_1-安装依赖" class="sidebar-link">1. 安装依赖</a></li><li class="sidebar-sub-header"><a href="/blogs/Django/django rest framework.html#_2-设置接口文档访问路径" class="sidebar-link">2. 设置接口文档访问路径</a></li><li class="sidebar-sub-header"><a href="/blogs/Django/django rest framework.html#_3-文档描述说明的定义位置" class="sidebar-link">3. 文档描述说明的定义位置</a></li><li class="sidebar-sub-header"><a href="/blogs/Django/django rest framework.html#_4-访问接口文档网页" class="sidebar-link">4. 访问接口文档网页</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="引入django-rest-framework"><a href="#引入django-rest-framework" class="header-anchor">#</a> 引入Django REST framework</h1> <p>在本章中，我们要大家介绍为什么学习Django REST framework，它能帮助我们做哪些事情。</p> <p><strong>课程思路</strong>：</p> <p>我们从分析现在流行的前后端分离Web应用模式说起，然后介绍如何设计REST API，通过使用Django来实现一个REST API为例，明确后端开发REST API要做的最核心工作，然后介绍Django REST framework能帮助我们简化开发REST API的工作。</p> <h1 id="web应用模式"><a href="#web应用模式" class="header-anchor">#</a> Web应用模式</h1> <p>在开发Web应用中，有两种应用模式：</p> <ul><li>前后端不分离</li> <li>前后端分离</li></ul> <h2 id="_1-前后端不分离"><a href="#_1-前后端不分离" class="header-anchor">#</a> 1 前后端不分离</h2> <p><img src="/image/drf/wallhaven-1kdzk3_1920x1080.png" alt="wallhaven-1kdzk3_1920x1080"></p> <p>在前后端不分离的应用模式中，前端页面看到的效果都是由后端控制，由后端渲染页面或重定向，也就是后端需要控制前端的展示，前端与后端的耦合度很高。</p> <p>这种应用模式比较适合纯网页应用，但是当后端对接App时，App可能并不需要后端返回一个HTML网页，而仅仅是数据本身，所以后端原本返回网页的接口不再适用于前端App应用，为了对接App后端还需再开发一套接口。</p> <h2 id="_2-前后端分离"><a href="#_2-前后端分离" class="header-anchor">#</a> 2 前后端分离</h2> <p><img src="/image/drf/indepent_frontend_backend.png" alt="indepent_frontend_backend">在前后端分离的应用模式中，后端仅返回前端所需的数据，不再渲染HTML页面，不再控制前端的效果。至于前端用户看到什么效果，从后端请求的数据如何加载到前端中，都由前端自己决定，网页有网页的处理方式，App有App的处理方式，但无论哪种前端，所需的数据基本相同，后端仅需开发一套逻辑对外提供数据即可。</p> <p>在前后端分离的应用模式中 ，前端与后端的耦合度相对较低。</p> <p>在前后端分离的应用模式中，我们通常将后端开发的每个视图都称为一个<strong>接口</strong>，或者<strong>API</strong>，前端通过访问接口来对数据进行增删改查。</p> <h1 id="认识restful"><a href="#认识restful" class="header-anchor">#</a> 认识RESTful</h1> <p><strong>在前后端分离的应用模式里，后端API接口如何定义？</strong></p> <ul><li>对于接口的请求方式与路径，每个后端开发人员可能都有自己的定义方式，风格迥异。</li> <li>是否存在一种统一的定义方式，被广大开发人员接受认可的方式呢？</li> <li>这就是被普遍采用的API的RESTful设计风格。</li> <li>例如对于后端数据库中保存了商品的信息，前端可能需要对商品数据进行增删改查，那相应的每个操作后端都需要提供一个API接口：</li></ul> <table><thead><tr><th>请求方法</th> <th>请求地址</th> <th>后端操作</th></tr></thead> <tbody><tr><td>GET</td> <td>/goods</td> <td>获取所有商品</td></tr> <tr><td>POST</td> <td>/goods</td> <td>增加商品</td></tr> <tr><td>GET</td> <td>/goods/1</td> <td>获取编号为1的商品</td></tr> <tr><td>PUT</td> <td>/goods/1</td> <td>修改编号为1的商品</td></tr> <tr><td>DELETE</td> <td>/goods/1</td> <td>删除编号为1的商品</td></tr></tbody></table> <h2 id="起源"><a href="#起源" class="header-anchor">#</a> 起源</h2> <p>REST这个词，是<a href="http://en.wikipedia.org/wiki/Roy_Fielding" target="_blank" rel="noopener noreferrer">Roy Thomas Fielding<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>在他2000年的<a href="http://www.ics.uci.edu/~fielding/pubs/dissertation/top.htm" target="_blank" rel="noopener noreferrer">博士论文<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>中提出的。</p> <p><img src="/image/drf/REST%E4%BD%9C%E8%80%85.jpeg" alt="REST作者"></p> <p>Fielding是一个非常重要的人，他是HTTP协议（1.0版和1.1版）的主要设计者、Apache服务器软件的作者之一、Apache基金会的第一任主席。所以，他的这篇论文一经发表，就引起了关注，并且立即对互联网开发产生了深远的影响。</p> <h2 id="说明"><a href="#说明" class="header-anchor">#</a> 说明</h2> <ul><li>RESTful是一种开发理念。<strong>REST</strong>是<strong>设计风格</strong>而不是标准。</li> <li>公司中的后端程序员在定义后端的接口时，可以选择是否遵守这种设计风格。</li> <li>RESTful设计风格的API，每种请求方法，都对应后端一种数据库操作。</li></ul> <h1 id="restful设计方法"><a href="#restful设计方法" class="header-anchor">#</a> RESTful设计方法</h1> <h2 id="_1-域名"><a href="#_1-域名" class="header-anchor">#</a> 1. 域名</h2> <p>应该尽量将API部署在专用域名之下。</p> <div class="language-http extra-class"><pre class="language-http"><code><span class="token header-name keyword">https:</span>//api.example.com
</code></pre></div><p>如果确定API很简单，不会有进一步扩展，可以考虑放在主域名下。</p> <div class="language-http extra-class"><pre class="language-http"><code><span class="token header-name keyword">https:</span>//example.org/api/
</code></pre></div><h2 id="_2-版本-versioning"><a href="#_2-版本-versioning" class="header-anchor">#</a> 2. 版本（Versioning）</h2> <p>应该将API的版本号放入URL。</p> <div class="language-http extra-class"><pre class="language-http"><code><span class="token header-name keyword">http:</span>//www.example.com/app/1.0/foo

<span class="token header-name keyword">http:</span>//www.example.com/app/1.1/foo

<span class="token header-name keyword">http:</span>//www.example.com/app/2.0/foo
</code></pre></div><p>另一种做法是，将版本号放在HTTP头信息中，但不如放入URL方便和直观。<a href="https://developer.github.com/v3/media/#request-specific-version" target="_blank" rel="noopener noreferrer">Github<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>采用这种做法。</p> <p>因为不同的版本，可以理解成同一种资源的不同表现形式，所以应该采用同一个URL。版本号可以在HTTP请求头信息的Accept字段中进行区分（参见<a href="http://www.informit.com/articles/article.aspx?p=1566460" target="_blank" rel="noopener noreferrer">Versioning REST Services<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>）：</p> <div class="language-http extra-class"><pre class="language-http"><code><span class="token header-name keyword">Accept:</span> vnd.example-com.foo+json; version=1.0

<span class="token header-name keyword">Accept:</span> vnd.example-com.foo+json; version=1.1

<span class="token header-name keyword">Accept:</span> vnd.example-com.foo+json; version=2.0
</code></pre></div><h2 id="_3-路径-endpoint"><a href="#_3-路径-endpoint" class="header-anchor">#</a> 3. 路径（Endpoint）</h2> <p>路径又称&quot;终点&quot;（endpoint），表示API的具体网址，每个网址代表一种资源（resource）</p> <p><strong>(1) 资源作为网址，只能有名词，不能有动词，而且所用的名词往往与数据库的表名对应。</strong></p> <p>举例来说，以下是不好的例子:</p> <div class="language-http extra-class"><pre class="language-http"><code>/getProducts
/listOrders
/retreiveClientByOrder?orderId=1
</code></pre></div><p>对于一个简洁结构，你应该始终用名词。 此外，利用的HTTP方法可以分离网址中的资源名称的操作。</p> <div class="language-http extra-class"><pre class="language-http"><code>GET /products ：将返回所有产品清单
POST /products ：将产品新建到集合
GET /products/4 ：将获取产品 4
PATCH（或）PUT /products/4 ：将更新产品 4
</code></pre></div><p><strong>(2) API中的名词应该使用复数。无论子资源或者所有资源。</strong></p> <p>举例来说，获取产品的API可以这样定义</p> <div class="language-http extra-class"><pre class="language-http"><code>获取单个产品：http://127.0.0.1:8080/AppName/rest/products/1
获取所有产品: http://127.0.0.1:8080/AppName/rest/products
</code></pre></div><h2 id="_3-http动词"><a href="#_3-http动词" class="header-anchor">#</a> 3. HTTP动词</h2> <p>对于资源的具体操作类型，由HTTP动词表示。</p> <p>常用的HTTP动词有下面四个（括号里是对应的SQL命令）。</p> <ul><li>GET（SELECT）：从服务器取出资源（一项或多项）。</li> <li>POST（CREATE）：在服务器新建一个资源。</li> <li>PUT（UPDATE）：在服务器更新资源（客户端提供改变后的完整资源）。</li> <li>DELETE（DELETE）：从服务器删除资源。</li></ul> <p>还有三个不常用的HTTP动词。</p> <ul><li>PATCH（UPDATE）：在服务器更新(更新)资源（客户端提供改变的属性）。</li> <li>HEAD：获取资源的元数据。</li> <li>OPTIONS：获取信息，关于资源的哪些属性是客户端可以改变的。</li></ul> <p>下面是一些例子。</p> <div class="language-http extra-class"><pre class="language-http"><code>GET /zoos：列出所有动物园
POST /zoos：新建一个动物园（上传文件）
GET /zoos/ID：获取某个指定动物园的信息
PUT /zoos/ID：更新某个指定动物园的信息（提供该动物园的全部信息）
PATCH /zoos/ID：更新某个指定动物园的信息（提供该动物园的部分信息）
DELETE /zoos/ID：删除某个动物园
GET /zoos/ID/animals：列出某个指定动物园的所有动物
DELETE /zoos/ID/animals/ID：删除某个指定动物园的指定动物
</code></pre></div><h2 id="_4-过滤信息-filtering"><a href="#_4-过滤信息-filtering" class="header-anchor">#</a> 4. 过滤信息（Filtering）</h2> <p>如果记录数量很多，服务器不可能都将它们返回给用户。API应该提供参数，过滤返回结果。</p> <p>下面是一些常见的参数。</p> <div class="language-http extra-class"><pre class="language-http"><code>?limit=10：指定返回记录的数量
?offset=10：指定返回记录的开始位置。
?page=2&amp;per_page=100：指定第几页，以及每页的记录数。
?sortby=name&amp;order=asc：指定返回结果按照哪个属性排序，以及排序顺序。
?animal_type_id=1：指定筛选条件
</code></pre></div><p>参数的设计允许存在冗余，即允许API路径和URL参数偶尔有重复。比如，GET /zoos/ID/animals 与 GET /animals?zoo_id=ID 的含义是相同的。</p> <h2 id="_6-状态码-status-codes"><a href="#_6-状态码-status-codes" class="header-anchor">#</a> 6. 状态码（Status Codes）</h2> <p>服务器向用户返回的状态码和提示信息，常见的有以下一些（方括号中是该状态码对应的HTTP动词）。</p> <blockquote><ul><li>200 OK - [GET]：服务器成功返回用户请求的数据</li> <li>201 CREATED - [POST/PUT/PATCH]：用户新建或修改数据成功。</li> <li>202 Accepted - [*]：表示一个请求已经进入后台排队（异步任务）</li> <li>204 NO CONTENT - [DELETE]：用户删除数据成功。</li> <li>400 INVALID REQUEST - [POST/PUT/PATCH]：用户发出的请求有错误，服务器没有进行新建或修改数据的操作</li> <li>401 Unauthorized - [*]：表示用户没有权限（令牌、用户名、密码错误）。</li> <li>403 Forbidden - [*] 表示用户得到授权（与401错误相对），但是访问是被禁止的。</li> <li>404 NOT FOUND - [*]：用户发出的请求针对的是不存在的记录，服务器没有进行操作，该操作是幂等的。</li> <li>406 Not Acceptable - [GET]：用户请求的格式不可得（比如用户请求JSON格式，但是只有XML格式）。</li> <li>410 Gone -[GET]：用户请求的资源被永久删除，且不会再得到的。</li> <li>422 Unprocesable entity - [POST/PUT/PATCH] 当创建一个对象时，发生一个验证错误。</li> <li>500 INTERNAL SERVER ERROR - [*]：服务器发生错误，用户将无法判断发出的请求是否成功。</li></ul></blockquote> <p>状态码的完全列表参见<a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html" target="_blank" rel="noopener noreferrer">这里<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>或<a href="https://zh.wikipedia.org/wiki/HTTP%E7%8A%B6%E6%80%81%E7%A0%81" target="_blank" rel="noopener noreferrer">这里<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <h2 id="_7-错误处理-error-handling"><a href="#_7-错误处理-error-handling" class="header-anchor">#</a> 7. 错误处理（Error handling）</h2> <p>如果状态码是4xx，服务器就应该向用户返回出错信息。一般来说，返回的信息中将error作为键名，出错信息作为键值即可。</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    error<span class="token operator">:</span> <span class="token string">&quot;Invalid API key&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_8-返回结果"><a href="#_8-返回结果" class="header-anchor">#</a> 8. 返回结果</h2> <p>针对不同操作，服务器向用户返回的结果应该符合以下规范。</p> <ul><li>GET /collection：返回资源对象的列表（数组）</li> <li>GET /collection/resource：返回单个资源对象</li> <li>POST /collection：返回新生成的资源对象</li> <li>PUT /collection/resource：返回完整的资源对象</li> <li>PATCH /collection/resource：返回完整的资源对象</li> <li>DELETE /collection/resource：返回一个空文档</li></ul> <h2 id="_9-超媒体-hypermedia-api"><a href="#_9-超媒体-hypermedia-api" class="header-anchor">#</a> 9. 超媒体（Hypermedia API）</h2> <p>RESTful API最好做到Hypermedia（即返回结果中提供链接，连向其他API方法），使得用户不查文档，也知道下一步应该做什么。</p> <p>比如，Github的API就是这种设计，访问<a href="https://api.github.com/" target="_blank" rel="noopener noreferrer">api.github.com<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>会得到一个所有可用API的网址列表。</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
<span class="token property">&quot;current_user_url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://api.github.com/user&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;authorizations_url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://api.github.com/authorizations&quot;</span><span class="token punctuation">,</span>
<span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>从上面可以看到，如果想获取当前用户的信息，应该去访问<a href="https://api.github.com/user" target="_blank" rel="noopener noreferrer">api.github.com/user<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，然后就得到了下面结果。</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;message&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Requires authentication&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;documentation_url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://developer.github.com/v3&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上面代码表示，服务器给出了提示信息，以及文档的网址。</p> <h2 id="_10-其他"><a href="#_10-其他" class="header-anchor">#</a> 10. 其他</h2> <p>服务器返回的数据格式，应该尽量使用JSON，避免使用XML。</p> <h1 id="使用django开发rest-接口"><a href="#使用django开发rest-接口" class="header-anchor">#</a> 使用Django开发REST 接口</h1> <p>我们以在Django框架中使用的图书英雄案例来写一套支持图书数据增删改查的REST API接口，来理解REST API的开发。</p> <p>在此案例中，前后端均发送JSON格式数据。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># views.py</span>

<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime

<span class="token keyword">class</span> <span class="token class-name">BooksAPIVIew</span><span class="token punctuation">(</span>View<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;
    查询所有图书、增加图书
    &quot;&quot;&quot;</span>
    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        查询所有图书
        路由：GET /books/
        &quot;&quot;&quot;</span>
        queryset <span class="token operator">=</span> BookInfo<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        book_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> book <span class="token keyword">in</span> queryset<span class="token punctuation">:</span>
            book_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token string">'id'</span><span class="token punctuation">:</span> book<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">,</span>
                <span class="token string">'btitle'</span><span class="token punctuation">:</span> book<span class="token punctuation">.</span>btitle<span class="token punctuation">,</span>
                <span class="token string">'bpub_date'</span><span class="token punctuation">:</span> book<span class="token punctuation">.</span>bpub_date<span class="token punctuation">,</span>
                <span class="token string">'bread'</span><span class="token punctuation">:</span> book<span class="token punctuation">.</span>bread<span class="token punctuation">,</span>
                <span class="token string">'bcomment'</span><span class="token punctuation">:</span> book<span class="token punctuation">.</span>bcomment<span class="token punctuation">,</span>
                <span class="token string">'image'</span><span class="token punctuation">:</span> book<span class="token punctuation">.</span>image<span class="token punctuation">.</span>url <span class="token keyword">if</span> book<span class="token punctuation">.</span>image <span class="token keyword">else</span> <span class="token string">''</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> JsonResponse<span class="token punctuation">(</span>book_list<span class="token punctuation">,</span> safe<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">post</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        新增图书
        路由：POST /books/ 
        &quot;&quot;&quot;</span>
        json_bytes <span class="token operator">=</span> request<span class="token punctuation">.</span>body
        json_str <span class="token operator">=</span> json_bytes<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>
        book_dict <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>json_str<span class="token punctuation">)</span>

        <span class="token comment"># 此处详细的校验参数省略</span>

        book <span class="token operator">=</span> BookInfo<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>
            btitle<span class="token operator">=</span>book_dict<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'btitle'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            bpub_date<span class="token operator">=</span>datetime<span class="token punctuation">.</span>strptime<span class="token punctuation">(</span>book_dict<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'bpub_date'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'%Y-%m-%d'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>date<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>

        <span class="token keyword">return</span> JsonResponse<span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token string">'id'</span><span class="token punctuation">:</span> book<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">,</span>
            <span class="token string">'btitle'</span><span class="token punctuation">:</span> book<span class="token punctuation">.</span>btitle<span class="token punctuation">,</span>
            <span class="token string">'bpub_date'</span><span class="token punctuation">:</span> book<span class="token punctuation">.</span>bpub_date<span class="token punctuation">,</span>
            <span class="token string">'bread'</span><span class="token punctuation">:</span> book<span class="token punctuation">.</span>bread<span class="token punctuation">,</span>
            <span class="token string">'bcomment'</span><span class="token punctuation">:</span> book<span class="token punctuation">.</span>bcomment<span class="token punctuation">,</span>
            <span class="token string">'image'</span><span class="token punctuation">:</span> book<span class="token punctuation">.</span>image<span class="token punctuation">.</span>url <span class="token keyword">if</span> book<span class="token punctuation">.</span>image <span class="token keyword">else</span> <span class="token string">''</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> status<span class="token operator">=</span><span class="token number">201</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">BookAPIView</span><span class="token punctuation">(</span>View<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> pk<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        获取单个图书信息
        路由： GET  /books/&lt;pk&gt;/
        &quot;&quot;&quot;</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            book <span class="token operator">=</span> BookInfo<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>pk<span class="token operator">=</span>pk<span class="token punctuation">)</span>
        <span class="token keyword">except</span> BookInfo<span class="token punctuation">.</span>DoesNotExist<span class="token punctuation">:</span>
            <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span>status<span class="token operator">=</span><span class="token number">404</span><span class="token punctuation">)</span>

        <span class="token keyword">return</span> JsonResponse<span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token string">'id'</span><span class="token punctuation">:</span> book<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">,</span>
            <span class="token string">'btitle'</span><span class="token punctuation">:</span> book<span class="token punctuation">.</span>btitle<span class="token punctuation">,</span>
            <span class="token string">'bpub_date'</span><span class="token punctuation">:</span> book<span class="token punctuation">.</span>bpub_date<span class="token punctuation">,</span>
            <span class="token string">'bread'</span><span class="token punctuation">:</span> book<span class="token punctuation">.</span>bread<span class="token punctuation">,</span>
            <span class="token string">'bcomment'</span><span class="token punctuation">:</span> book<span class="token punctuation">.</span>bcomment<span class="token punctuation">,</span>
            <span class="token string">'image'</span><span class="token punctuation">:</span> book<span class="token punctuation">.</span>image<span class="token punctuation">.</span>url <span class="token keyword">if</span> book<span class="token punctuation">.</span>image <span class="token keyword">else</span> <span class="token string">''</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">put</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> pk<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        修改图书信息
        路由： PUT  /books/&lt;pk&gt;
        &quot;&quot;&quot;</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            book <span class="token operator">=</span> BookInfo<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>pk<span class="token operator">=</span>pk<span class="token punctuation">)</span>
        <span class="token keyword">except</span> BookInfo<span class="token punctuation">.</span>DoesNotExist<span class="token punctuation">:</span>
            <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span>status<span class="token operator">=</span><span class="token number">404</span><span class="token punctuation">)</span>

        json_bytes <span class="token operator">=</span> request<span class="token punctuation">.</span>body
        json_str <span class="token operator">=</span> json_bytes<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>
        book_dict <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>json_str<span class="token punctuation">)</span>

        <span class="token comment"># 此处详细的校验参数省略</span>

        book<span class="token punctuation">.</span>btitle <span class="token operator">=</span> book_dict<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'btitle'</span><span class="token punctuation">)</span>
        book<span class="token punctuation">.</span>bpub_date <span class="token operator">=</span> datetime<span class="token punctuation">.</span>strptime<span class="token punctuation">(</span>book_dict<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'bpub_date'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'%Y-%m-%d'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>date<span class="token punctuation">(</span><span class="token punctuation">)</span>
        book<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token keyword">return</span> JsonResponse<span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token string">'id'</span><span class="token punctuation">:</span> book<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">,</span>
            <span class="token string">'btitle'</span><span class="token punctuation">:</span> book<span class="token punctuation">.</span>btitle<span class="token punctuation">,</span>
            <span class="token string">'bpub_date'</span><span class="token punctuation">:</span> book<span class="token punctuation">.</span>bpub_date<span class="token punctuation">,</span>
            <span class="token string">'bread'</span><span class="token punctuation">:</span> book<span class="token punctuation">.</span>bread<span class="token punctuation">,</span>
            <span class="token string">'bcomment'</span><span class="token punctuation">:</span> book<span class="token punctuation">.</span>bcomment<span class="token punctuation">,</span>
            <span class="token string">'image'</span><span class="token punctuation">:</span> book<span class="token punctuation">.</span>image<span class="token punctuation">.</span>url <span class="token keyword">if</span> book<span class="token punctuation">.</span>image <span class="token keyword">else</span> <span class="token string">''</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">delete</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> pk<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        删除图书
        路由： DELETE /books/&lt;pk&gt;/
        &quot;&quot;&quot;</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            book <span class="token operator">=</span> BookInfo<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>pk<span class="token operator">=</span>pk<span class="token punctuation">)</span>
        <span class="token keyword">except</span> BookInfo<span class="token punctuation">.</span>DoesNotExist<span class="token punctuation">:</span>
            <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span>status<span class="token operator">=</span><span class="token number">404</span><span class="token punctuation">)</span>

        book<span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span>status<span class="token operator">=</span><span class="token number">204</span><span class="token punctuation">)</span>
<span class="token comment"># urls.py</span>

urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>
    url<span class="token punctuation">(</span><span class="token string">r'^books/$'</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>BooksAPIVIew<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    url<span class="token punctuation">(</span><span class="token string">r'^books/(?P&lt;pk&gt;\d+)/$'</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>BookAPIView<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre></div><h4 id="测试"><a href="#测试" class="header-anchor">#</a> 测试</h4> <p>使用Postman测试上述接口</p> <p>1） 获取所有图书数据</p> <p>GET 方式访问 http://127.0.0.1:8000/books/， 返回状态码200，数据如下</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token property">&quot;btitle&quot;</span><span class="token operator">:</span> <span class="token string">&quot;射雕英雄传&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;bpub_date&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1980-05-01&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;bread&quot;</span><span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">,</span>
        <span class="token property">&quot;bcomment&quot;</span><span class="token operator">:</span> <span class="token number">34</span><span class="token punctuation">,</span>
        <span class="token property">&quot;image&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
        <span class="token property">&quot;btitle&quot;</span><span class="token operator">:</span> <span class="token string">&quot;天龙八部&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;bpub_date&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1986-07-24&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;bread&quot;</span><span class="token operator">:</span> <span class="token number">36</span><span class="token punctuation">,</span>
        <span class="token property">&quot;bcomment&quot;</span><span class="token operator">:</span> <span class="token number">40</span><span class="token punctuation">,</span>
        <span class="token property">&quot;image&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
        <span class="token property">&quot;btitle&quot;</span><span class="token operator">:</span> <span class="token string">&quot;笑傲江湖&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;bpub_date&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1995-12-24&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;bread&quot;</span><span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
        <span class="token property">&quot;bcomment&quot;</span><span class="token operator">:</span> <span class="token number">80</span><span class="token punctuation">,</span>
        <span class="token property">&quot;image&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
        <span class="token property">&quot;btitle&quot;</span><span class="token operator">:</span> <span class="token string">&quot;雪山飞狐&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;bpub_date&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1987-11-11&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;bread&quot;</span><span class="token operator">:</span> <span class="token number">58</span><span class="token punctuation">,</span>
        <span class="token property">&quot;bcomment&quot;</span><span class="token operator">:</span> <span class="token number">24</span><span class="token punctuation">,</span>
        <span class="token property">&quot;image&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
        <span class="token property">&quot;btitle&quot;</span><span class="token operator">:</span> <span class="token string">&quot;西游记&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;bpub_date&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1988-01-01&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;bread&quot;</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
        <span class="token property">&quot;bcomment&quot;</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
        <span class="token property">&quot;image&quot;</span><span class="token operator">:</span> <span class="token string">&quot;booktest/xiyouji.png&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span>
        <span class="token property">&quot;btitle&quot;</span><span class="token operator">:</span> <span class="token string">&quot;水浒传&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;bpub_date&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1992-01-01&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;bread&quot;</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
        <span class="token property">&quot;bcomment&quot;</span><span class="token operator">:</span> <span class="token number">11</span><span class="token punctuation">,</span>
        <span class="token property">&quot;image&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">7</span><span class="token punctuation">,</span>
        <span class="token property">&quot;btitle&quot;</span><span class="token operator">:</span> <span class="token string">&quot;红楼梦&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;bpub_date&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1990-01-01&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;bread&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token property">&quot;bcomment&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token property">&quot;image&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div><p>2）获取单一图书数据</p> <p>GET 访问 http://127.0.0.1:8000/books/5/ ，返回状态码200， 数据如下</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
    <span class="token property">&quot;btitle&quot;</span><span class="token operator">:</span> <span class="token string">&quot;西游记&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;bpub_date&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1988-01-01&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;bread&quot;</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
    <span class="token property">&quot;bcomment&quot;</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
    <span class="token property">&quot;image&quot;</span><span class="token operator">:</span> <span class="token string">&quot;booktest/xiyouji.png&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>GET 访问http://127.0.0.1:8000/books/100/，返回状态码404</p> <p>3）新增图书数据</p> <p>POST 访问http://127.0.0.1:8000/books/，发送JSON数据：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;btitle&quot;</span><span class="token operator">:</span> <span class="token string">&quot;三国演义&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;bpub_date&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1990-02-03&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>返回状态码201，数据如下</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span>
    <span class="token property">&quot;btitle&quot;</span><span class="token operator">:</span> <span class="token string">&quot;三国演义&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;bpub_date&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1990-02-03&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;bread&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">&quot;bcomment&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">&quot;image&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>4）修改图书数据</p> <p>PUT 访问http://127.0.0.1:8000/books/8/，发送JSON数据：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;btitle&quot;</span><span class="token operator">:</span> <span class="token string">&quot;三国演义（第二版）&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;bpub_date&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1990-02-03&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>返回状态码200，数据如下</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span>
    <span class="token property">&quot;btitle&quot;</span><span class="token operator">:</span> <span class="token string">&quot;三国演义（第二版）&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;bpub_date&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1990-02-03&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;bread&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">&quot;bcomment&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">&quot;image&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>5）删除图书数据</p> <p>DELETE 访问http://127.0.0.1:8000/books/8/，返回204状态码</p> <h1 id="明确rest接口开发的核心任务"><a href="#明确rest接口开发的核心任务" class="header-anchor">#</a> 明确REST接口开发的核心任务</h1> <p>分析一下上节的案例，可以发现，在开发REST API接口时，视图中做的最主要有三件事：</p> <ul><li>将请求的数据（如JSON格式）转换为模型类对象</li> <li>操作数据库</li> <li>将模型类对象转换为响应的数据（如JSON格式）</li></ul> <h2 id="序列化serialization"><a href="#序列化serialization" class="header-anchor">#</a> 序列化Serialization</h2> <p><a href="https://zh.wikipedia.org/wiki/%E5%BA%8F%E5%88%97%E5%8C%96" target="_blank" rel="noopener noreferrer">维基百科<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>中对于序列化的定义：</p> <p><strong>序列化</strong>（serialization）在计算机科学的资料处理中，是指将数据结构或物件状态转换成可取用格式（例如存成档案，存于缓冲，或经由网络中传送），以留待后续在相同或另一台计算机环境中，能恢复原先状态的过程。依照序列化格式重新获取字节的结果时，可以利用它来产生与原始物件相同语义的副本。对于许多物件，像是使用大量参照的复杂物件，这种序列化重建的过程并不容易。面向对象中的物件序列化，并不概括之前原始物件所关联的函式。这种过程也称为物件编组（marshalling）。从一系列字节提取数据结构的反向操作，是反序列化（也称为解编组, deserialization, unmarshalling）。</p> <p><strong>序列化</strong>在计算机科学中通常有以下定义:</p> <p>在数据储存与传送的部分是指将一个<a href="https://zh.wikipedia.org/wiki/%E5%AF%B9%E8%B1%A1_(%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6)" target="_blank" rel="noopener noreferrer">对象<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>存储至一个<a href="https://zh.wikipedia.org/w/index.php?title=%E5%84%B2%E5%AD%98%E5%AA%92%E4%BB%8B&amp;action=edit&amp;redlink=1" target="_blank" rel="noopener noreferrer">储存媒介<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，例如<a href="https://zh.wikipedia.org/wiki/%E6%AA%94%E6%A1%88" target="_blank" rel="noopener noreferrer">档案<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>或是<a href="https://zh.wikipedia.org/w/index.php?title=%E8%A8%98%E5%84%84%E9%AB%94%E7%B7%A9%E8%A1%9D&amp;action=edit&amp;redlink=1" target="_blank" rel="noopener noreferrer">记亿体缓冲<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>等，或者透过网络传送资料时进行编码的过程，可以是<a href="https://zh.wikipedia.org/wiki/%E5%AD%97%E8%8A%82" target="_blank" rel="noopener noreferrer">字节<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>或是<a href="https://zh.wikipedia.org/wiki/XML" target="_blank" rel="noopener noreferrer">XML<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>等格式。而<a href="https://zh.wikipedia.org/wiki/%E5%AD%97%E8%8A%82" target="_blank" rel="noopener noreferrer">字节<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>的或<a href="https://zh.wikipedia.org/wiki/XML" target="_blank" rel="noopener noreferrer">XML<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>编码格式可以还原完全相等的<a href="https://zh.wikipedia.org/wiki/%E5%AF%B9%E8%B1%A1_(%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6)" target="_blank" rel="noopener noreferrer">对象<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。这程序被应用在不同<a href="https://zh.wikipedia.org/wiki/%E6%87%89%E7%94%A8%E7%A8%8B%E5%BC%8F" target="_blank" rel="noopener noreferrer">应用程序<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>之间传送<a href="https://zh.wikipedia.org/wiki/%E5%AF%B9%E8%B1%A1_(%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6)" target="_blank" rel="noopener noreferrer">对象<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，以及服务器将<a href="https://zh.wikipedia.org/wiki/%E5%AF%B9%E8%B1%A1_(%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6)" target="_blank" rel="noopener noreferrer">对象<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>储存到<a href="https://zh.wikipedia.org/wiki/%E6%AA%94%E6%A1%88" target="_blank" rel="noopener noreferrer">档案<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>或<a href="https://zh.wikipedia.org/wiki/%E8%B3%87%E6%96%99%E5%BA%AB" target="_blank" rel="noopener noreferrer">数据库<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。相反的过程又称为<a href="https://zh.wikipedia.org/w/index.php?title=%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96&amp;action=edit&amp;redlink=1" target="_blank" rel="noopener noreferrer"><strong>反序列化</strong><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <p>简而言之，我们可以将<strong>序列化</strong>理解为：</p> <p><strong>将程序中的一个数据结构类型转换为其他格式（字典、JSON、XML等），例如将Django中的模型类对象装换为JSON字符串，这个转换过程我们称为序列化。</strong></p> <p>如：</p> <div class="language-python extra-class"><pre class="language-python"><code>queryset <span class="token operator">=</span> BookInfo<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
book_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token comment"># 序列化</span>
<span class="token keyword">for</span> book <span class="token keyword">in</span> queryset<span class="token punctuation">:</span>
    book_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token string">'id'</span><span class="token punctuation">:</span> book<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">,</span>
        <span class="token string">'btitle'</span><span class="token punctuation">:</span> book<span class="token punctuation">.</span>btitle<span class="token punctuation">,</span>
        <span class="token string">'bpub_date'</span><span class="token punctuation">:</span> book<span class="token punctuation">.</span>bpub_date<span class="token punctuation">,</span>
        <span class="token string">'bread'</span><span class="token punctuation">:</span> book<span class="token punctuation">.</span>bread<span class="token punctuation">,</span>
        <span class="token string">'bcomment'</span><span class="token punctuation">:</span> book<span class="token punctuation">.</span>bcomment<span class="token punctuation">,</span>
        <span class="token string">'image'</span><span class="token punctuation">:</span> book<span class="token punctuation">.</span>image<span class="token punctuation">.</span>url <span class="token keyword">if</span> book<span class="token punctuation">.</span>image <span class="token keyword">else</span> <span class="token string">''</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">return</span> JsonResponse<span class="token punctuation">(</span>book_list<span class="token punctuation">,</span> safe<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>反之，将其他格式（字典、JSON、XML等）转换为程序中的数据，例如将JSON字符串转换为Django中的模型类对象，这个过程我们称为反序列化。</strong></p> <p>如：</p> <div class="language-python extra-class"><pre class="language-python"><code>json_bytes <span class="token operator">=</span> request<span class="token punctuation">.</span>body
json_str <span class="token operator">=</span> json_bytes<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 反序列化</span>
book_dict <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>json_str<span class="token punctuation">)</span>
book <span class="token operator">=</span> BookInfo<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>
    btitle<span class="token operator">=</span>book_dict<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'btitle'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    bpub_date<span class="token operator">=</span>datetime<span class="token punctuation">.</span>strptime<span class="token punctuation">(</span>book_dict<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'bpub_date'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'%Y-%m-%d'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>date<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre></div><p>我们可以看到，<strong>在开发REST API时，视图中要频繁的进行序列化与反序列化的编写。</strong></p> <h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <p>在开发REST API接口时，我们在<strong>视图</strong>中需要做的最核心的事是：</p> <ul><li><strong>将数据库数据序列化为前端所需要的格式，并返回；</strong></li> <li><strong>将前端发送的数据反序列化为模型类对象，并保存到数据库中。</strong></li></ul> <h1 id="django-rest-framework-简介"><a href="#django-rest-framework-简介" class="header-anchor">#</a> Django REST framework 简介</h1> <ol><li>在序列化与反序列化时，虽然操作的数据不尽相同，但是执行的过程却是相似的，也就是说这部分代码是可以复用简化编写的。</li> <li>在开发REST API的视图中，虽然每个视图具体操作的数据不同，但增、删、改、查的实现流程基本套路化，所以这部分代码也是可以复用简化编写的：
<ul><li><strong>增</strong>：校验请求数据 -&gt; 执行反序列化过程 -&gt; 保存数据库 -&gt; 将保存的对象序列化并返回</li> <li><strong>删</strong>：判断要删除的数据是否存在 -&gt; 执行数据库删除</li> <li><strong>改</strong>：判断要修改的数据是否存在 -&gt; 校验请求的数据 -&gt; 执行反序列化过程 -&gt; 保存数据库 -&gt; 将保存的对象序列化并返回</li> <li><strong>查</strong>：查询数据库 -&gt; 将数据序列化并返回</li></ul></li></ol> <p><strong>Django REST framework可以帮助我们简化上述两部分的代码编写，大大提高REST API的开发速度。</strong></p> <h2 id="认识django-rest-framework"><a href="#认识django-rest-framework" class="header-anchor">#</a> 认识Django REST framework</h2> <p><img src="/image/drf/drf_logo.png" alt="drf_logo"></p> <p>Django REST framework 框架是一个用于构建Web API 的强大而又灵活的工具。</p> <p>通常简称为DRF框架 或 REST framework。</p> <p>DRF框架是建立在Django框架基础之上，由Tom Christie大牛二次开发的开源项目。</p> <h3 id="特点"><a href="#特点" class="header-anchor">#</a> 特点</h3> <ul><li>提供了定义序列化器Serializer的方法，可以快速根据 Django ORM 或者其它库自动序列化/反序列化；</li> <li>提供了丰富的类视图、Mixin扩展类，简化视图的编写；</li> <li>丰富的定制层级：函数视图、类视图、视图集合到自动生成 API，满足各种需要；</li> <li>多种身份认证和权限认证方式的支持；</li> <li>内置了限流系统；</li> <li>直观的 API web 界面；</li> <li>可扩展性，插件丰富</li></ul> <p>资料：</p> <ul><li><a href="http://www.django-rest-framework.org/" target="_blank" rel="noopener noreferrer">官方文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/encode/django-rest-framework/tree/master" target="_blank" rel="noopener noreferrer">Github源码<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h1 id="环境安装与配置"><a href="#环境安装与配置" class="header-anchor">#</a> 环境安装与配置</h1> <p>DRF需要以下依赖：</p> <ul><li>Python (2.7, 3.4, 3.5, 3.6, 3.7)</li> <li>Django (1.11, 2.0, 2.1)</li></ul> <p><strong>DRF是以Django扩展应用的方式提供的，所以我们可以直接利用已有的Django环境而无需从新创建。（若没有Django环境，需要先创建环境安装Django）</strong></p> <h2 id="_1-安装drf"><a href="#_1-安装drf" class="header-anchor">#</a> 1. 安装DRF</h2> <div class="language-shell extra-class"><pre class="language-shell"><code>pip <span class="token function">install</span> djangorestframework
</code></pre></div><h2 id="_2-添加rest-framework应用"><a href="#_2-添加rest-framework应用" class="header-anchor">#</a> 2. 添加rest_framework应用</h2> <p>我们利用在Django框架学习中创建的demo工程，在<strong>settings.py</strong>的<strong>INSTALLED_APPS</strong>中添加'rest_framework'。</p> <div class="language-python extra-class"><pre class="language-python"><code>INSTALLED_APPS <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token string">'rest_framework'</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre></div><p>接下来就可以使用DRF进行开发了。</p> <h1 id="见识drf的魅力"><a href="#见识drf的魅力" class="header-anchor">#</a> 见识DRF的魅力</h1> <p>我们仍以在学习Django框架时使用的图书英雄为案例，使用Django REST framework快速实现图书的REST API。</p> <h2 id="_1-创建序列化器"><a href="#_1-创建序列化器" class="header-anchor">#</a> 1. 创建序列化器</h2> <p>在booktest应用中新建serializers.py用于保存该应用的序列化器。</p> <p>创建一个BookInfoSerializer用于序列化与反序列化。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">BookInfoSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>ModelSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;图书数据序列化器&quot;&quot;&quot;</span>
    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        model <span class="token operator">=</span> BookInfo
        fields <span class="token operator">=</span> <span class="token string">'__all__'</span>
</code></pre></div><ul><li><strong>model</strong> 指明该序列化器处理的数据字段从模型类BookInfo参考生成</li> <li><strong>fields</strong> 指明该序列化器包含模型类中的哪些字段，'<strong>all</strong>'指明包含所有字段</li></ul> <h2 id="_2-编写视图"><a href="#_2-编写视图" class="header-anchor">#</a> 2. 编写视图</h2> <p>在booktest应用的views.py中创建视图BookInfoViewSet，这是一个视图集合。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>viewsets <span class="token keyword">import</span> ModelViewSet
<span class="token keyword">from</span> <span class="token punctuation">.</span>serializers <span class="token keyword">import</span> BookInfoSerializer
<span class="token keyword">from</span> <span class="token punctuation">.</span>models <span class="token keyword">import</span> BookInfo

<span class="token keyword">class</span> <span class="token class-name">BookInfoViewSet</span><span class="token punctuation">(</span>ModelViewSet<span class="token punctuation">)</span><span class="token punctuation">:</span>
    queryset <span class="token operator">=</span> BookInfo<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    serializer_class <span class="token operator">=</span> BookInfoSerializer
</code></pre></div><ul><li><strong>queryset</strong> 指明该视图集在查询数据时使用的查询集</li> <li><strong>serializer_class</strong> 指明该视图在进行序列化或反序列化时使用的序列化器</li></ul> <h2 id="_3-定义路由"><a href="#_3-定义路由" class="header-anchor">#</a> 3. 定义路由</h2> <p>在booktest应用的urls.py中定义路由信息。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> <span class="token punctuation">.</span> <span class="token keyword">import</span> views
<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>routers <span class="token keyword">import</span> DefaultRouter

urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">]</span>

router <span class="token operator">=</span> DefaultRouter<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 可以处理视图的路由器</span>
router<span class="token punctuation">.</span>register<span class="token punctuation">(</span><span class="token string">r'books'</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>BookInfoViewSet<span class="token punctuation">)</span>  <span class="token comment"># 向路由器中注册视图集</span>

urlpatterns <span class="token operator">+=</span> router<span class="token punctuation">.</span>urls  <span class="token comment"># 将路由器中的所以路由信息追到到django的路由列表中</span>
</code></pre></div><h2 id="_4-运行测试"><a href="#_4-运行测试" class="header-anchor">#</a> 4. 运行测试</h2> <p>运行当前程序（与运行Django一样）</p> <div class="language-shell extra-class"><pre class="language-shell"><code>python manage.py runserver
</code></pre></div><p>在浏览器中输入网址127.0.0.1:8000，可以看到DRF提供的API Web浏览页面：</p> <p><img src="/image/drf/%E5%9B%BE%E4%B9%A6%E6%8E%A5%E5%8F%A3Web%E6%B5%8F%E8%A7%88%E9%A1%B5%E9%9D%A2.png" alt="图书接口Web浏览页面">1)点击链接127.0.0.1:8000/books/ 可以访问<strong>获取所有数据的接口</strong>，呈现如下页面：</p> <p><img src="/image/drf/%E6%9F%A5%E8%AF%A2%E6%89%80%E6%9C%89%E5%9B%BE%E4%B9%A6%E4%BF%A1%E6%81%AF1.png" alt="查询所有图书信息1"></p> <p><img src="/image/drf/%E6%9F%A5%E8%AF%A2%E6%89%80%E6%9C%89%E5%9B%BE%E4%B9%A6%E9%A1%B5%E9%9D%A22.png" alt="查询所有图书页面2"></p> <p>2）在页面底下表单部分填写图书信息，可以访问<strong>添加新图书的接口</strong>，保存新书：</p> <p><img src="/image/drf/%E4%BF%9D%E5%AD%98%E6%96%B0%E5%9B%BE%E4%B9%A6%E4%BF%A1%E6%81%AF.png" alt="保存新图书信息"></p> <p>点击POST后，返回如下页面信息：</p> <p><img src="/image/drf/%E4%BF%9D%E5%AD%98%E5%9B%BE%E4%B9%A6%E8%BF%94%E5%9B%9E%E4%BF%A1%E6%81%AF.png" alt="保存图书返回信息"></p> <p>3）在浏览器中输入网址127.0.0.1:8000/books/1/，可以访问<strong>获取单一图书信息的接口</strong>（id为1的图书），呈现如下页面：</p> <p><img src="/image/drf/%E8%8E%B7%E5%8F%96%E5%8D%95%E4%B8%80%E5%9B%BE%E4%B9%A6%E4%BF%A1%E6%81%AF.png" alt="获取单一图书信息"></p> <p>4）在页面底部表单中填写图书信息，可以访问<strong>修改图书的接口</strong>：</p> <p><img src="/image/drf/%E4%BF%AE%E6%94%B9%E5%9B%BE%E4%B9%A6%E4%BF%A1%E6%81%AF.png" alt="修改图书信息"></p> <p>点击PUT，返回如下页面信息：</p> <p><img src="/image/drf/%E4%BF%AE%E6%94%B9%E5%9B%BE%E4%B9%A6%E8%BF%94%E5%9B%9E%E4%BF%A1%E6%81%AF.png" alt="修改图书返回信息"></p> <p>5）点击DELETE按钮，可以访问<strong>删除图书的接口</strong>：</p> <p><img src="/image/drf/%E5%88%A0%E9%99%A4%E5%9B%BE%E4%B9%A6.png" alt="删除图书"></p> <p>返回，如下页面：</p> <p><img src="/image/drf/%E5%88%A0%E9%99%A4%E8%BF%94%E5%9B%9E%E4%BF%A1%E6%81%AF.png" alt="删除返回信息"></p> <p>至此，是不是发现Django REST framework很好用！</p> <h1 id="序列化使用"><a href="#序列化使用" class="header-anchor">#</a> 序列化使用</h1> <p>我们在django shell中来学习序列化器的使用。</p> <div class="language-shell extra-class"><pre class="language-shell"><code>python manage.py shell
</code></pre></div><h2 id="_1-基本使用"><a href="#_1-基本使用" class="header-anchor">#</a> 1 基本使用</h2> <p>1） 先查询出一个图书对象</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> booktest<span class="token punctuation">.</span>models <span class="token keyword">import</span> BookInfo

book <span class="token operator">=</span> BookInfo<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
</code></pre></div><p>2） 构造序列化器对象</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> booktest<span class="token punctuation">.</span>serializers <span class="token keyword">import</span> BookInfoSerializer

serializer <span class="token operator">=</span> BookInfoSerializer<span class="token punctuation">(</span>book<span class="token punctuation">)</span>
</code></pre></div><p>3）获取序列化数据</p> <p>通过data属性可以获取序列化后的数据</p> <div class="language-python extra-class"><pre class="language-python"><code>serializer<span class="token punctuation">.</span>data
<span class="token comment"># {'id': 2, 'btitle': '天龙八部', 'bpub_date': '1986-07-24', 'bread': 36, 'bcomment': 40, 'image': None}</span>
</code></pre></div><p>4）如果要被序列化的是包含多条数据的查询集QuerySet，可以通过添加<strong>many=True</strong>参数补充说明</p> <div class="language-python extra-class"><pre class="language-python"><code>book_qs <span class="token operator">=</span> BookInfo<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
serializer <span class="token operator">=</span> BookInfoSerializer<span class="token punctuation">(</span>book_qs<span class="token punctuation">,</span> many<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
serializer<span class="token punctuation">.</span>data
<span class="token comment"># [OrderedDict([('id', 2), ('btitle', '天龙八部'), ('bpub_date', '1986-07-24'), ('bread', 36), ('bcomment', 40), ('image', N]), OrderedDict([('id', 3), ('btitle', '笑傲江湖'), ('bpub_date', '1995-12-24'), ('bread', 20), ('bcomment', 80), ('image'ne)]), OrderedDict([('id', 4), ('btitle', '雪山飞狐'), ('bpub_date', '1987-11-11'), ('bread', 58), ('bcomment', 24), ('ima None)]), OrderedDict([('id', 5), ('btitle', '西游记'), ('bpub_date', '1988-01-01'), ('bread', 10), ('bcomment', 10), ('im', 'booktest/xiyouji.png')])]</span>
</code></pre></div><h2 id="_2-关联对象嵌套序列化"><a href="#_2-关联对象嵌套序列化" class="header-anchor">#</a> 2 关联对象嵌套序列化</h2> <p>如果需要序列化的数据中包含有其他关联对象，则对关联对象数据的序列化需要指明。</p> <p>例如，在定义英雄数据的序列化器时，外键hbook（即所属的图书）字段如何序列化？</p> <p>我们先定义HeroInfoSerialzier除外键字段外的其他部分</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">HeroInfoSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>Serializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;英雄数据序列化器&quot;&quot;&quot;</span>
    GENDER_CHOICES <span class="token operator">=</span> <span class="token punctuation">(</span>
        <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'female'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'male'</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
    <span class="token builtin">id</span> <span class="token operator">=</span> serializers<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>label<span class="token operator">=</span><span class="token string">'ID'</span><span class="token punctuation">,</span> read_only<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    hname <span class="token operator">=</span> serializers<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>label<span class="token operator">=</span><span class="token string">'名字'</span><span class="token punctuation">,</span> max_length<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span>
    hgender <span class="token operator">=</span> serializers<span class="token punctuation">.</span>ChoiceField<span class="token punctuation">(</span>choices<span class="token operator">=</span>GENDER_CHOICES<span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'性别'</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
    hcomment <span class="token operator">=</span> serializers<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>label<span class="token operator">=</span><span class="token string">'描述信息'</span><span class="token punctuation">,</span> max_length<span class="token operator">=</span><span class="token number">200</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> allow_null<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre></div><p>对于关联字段，可以采用以下几种方式：</p> <h4 id="_1-primarykeyrelatedfield"><a href="#_1-primarykeyrelatedfield" class="header-anchor">#</a> 1） PrimaryKeyRelatedField</h4> <p>此字段将被序列化为关联对象的主键。</p> <div class="language-python extra-class"><pre class="language-python"><code>hbook <span class="token operator">=</span> serializers<span class="token punctuation">.</span>PrimaryKeyRelatedField<span class="token punctuation">(</span>label<span class="token operator">=</span><span class="token string">'图书'</span><span class="token punctuation">,</span> read_only<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
或
hbook <span class="token operator">=</span> serializers<span class="token punctuation">.</span>PrimaryKeyRelatedField<span class="token punctuation">(</span>label<span class="token operator">=</span><span class="token string">'图书'</span><span class="token punctuation">,</span> queryset<span class="token operator">=</span>BookInfo<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>指明字段时需要包含read_only=True或者queryset参数：</p> <ul><li>包含read_only=True参数时，该字段将不能用作反序列化使用</li> <li>包含queryset参数时，将被用作反序列化时参数校验使用</li></ul> <p>使用效果：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> booktest<span class="token punctuation">.</span>serializers <span class="token keyword">import</span> HeroInfoSerializer
<span class="token keyword">from</span> booktest<span class="token punctuation">.</span>models <span class="token keyword">import</span> HeroInfo
hero <span class="token operator">=</span> HeroInfo<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">)</span>
serializer <span class="token operator">=</span> HeroInfoSerializer<span class="token punctuation">(</span>hero<span class="token punctuation">)</span>
serializer<span class="token punctuation">.</span>data
<span class="token comment"># {'id': 6, 'hname': '乔峰', 'hgender': 1, 'hcomment': '降龙十八掌', 'hbook': 2}</span>
</code></pre></div><h4 id="_2-stringrelatedfield"><a href="#_2-stringrelatedfield" class="header-anchor">#</a> 2) StringRelatedField</h4> <p>此字段将被序列化为关联对象的字符串表示方式（即__str__方法的返回值）</p> <div class="language-python extra-class"><pre class="language-python"><code>hbook <span class="token operator">=</span> serializers<span class="token punctuation">.</span>StringRelatedField<span class="token punctuation">(</span>label<span class="token operator">=</span><span class="token string">'图书'</span><span class="token punctuation">)</span>
</code></pre></div><p>使用效果</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token punctuation">{</span><span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token string">'hname'</span><span class="token punctuation">:</span> <span class="token string">'乔峰'</span><span class="token punctuation">,</span> <span class="token string">'hgender'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'hcomment'</span><span class="token punctuation">:</span> <span class="token string">'降龙十八掌'</span><span class="token punctuation">,</span> <span class="token string">'hbook'</span><span class="token punctuation">:</span> <span class="token string">'天龙八部'</span><span class="token punctuation">}</span>
</code></pre></div><h4 id="_3-使用关联对象的序列化器"><a href="#_3-使用关联对象的序列化器" class="header-anchor">#</a> 3）使用关联对象的序列化器</h4> <div class="language-python extra-class"><pre class="language-python"><code>hbook <span class="token operator">=</span> BookInfoSerializer<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>使用效果</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token punctuation">{</span><span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token string">'hname'</span><span class="token punctuation">:</span> <span class="token string">'乔峰'</span><span class="token punctuation">,</span> <span class="token string">'hgender'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'hcomment'</span><span class="token punctuation">:</span> <span class="token string">'降龙十八掌'</span><span class="token punctuation">,</span> <span class="token string">'hbook'</span><span class="token punctuation">:</span> OrderedDict<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'btitle'</span><span class="token punctuation">,</span> <span class="token string">'天龙八部'</span><span class="token punctuation">)</span>te<span class="token string">', '</span><span class="token number">1986</span><span class="token operator">-</span><span class="token number">07</span><span class="token operator">-</span><span class="token number">24</span><span class="token string">'), ('</span>bread<span class="token string">', 36), ('</span>bcomment<span class="token string">', 40), ('</span>image'<span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
</code></pre></div><h2 id="_3-many参数"><a href="#_3-many参数" class="header-anchor">#</a> 3 many参数</h2> <p>如果关联的对象数据不是只有一个，而是包含多个数据，如想序列化图书BookInfo数据，每个BookInfo对象关联的英雄HeroInfo对象可能有多个，此时关联字段类型的指明仍可使用上述几种方式，只是在声明关联字段时，多补充一个many=True参数即可。</p> <p>此处仅拿PrimaryKeyRelatedField类型来举例，其他相同。</p> <p>在BookInfoSerializer中添加关联字段：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">BookInfoSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>Serializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;图书数据序列化器&quot;&quot;&quot;</span>
    <span class="token builtin">id</span> <span class="token operator">=</span> serializers<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>label<span class="token operator">=</span><span class="token string">'ID'</span><span class="token punctuation">,</span> read_only<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    btitle <span class="token operator">=</span> serializers<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>label<span class="token operator">=</span><span class="token string">'名称'</span><span class="token punctuation">,</span> max_length<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span>
    bpub_date <span class="token operator">=</span> serializers<span class="token punctuation">.</span>DateField<span class="token punctuation">(</span>label<span class="token operator">=</span><span class="token string">'发布日期'</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    bread <span class="token operator">=</span> serializers<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>label<span class="token operator">=</span><span class="token string">'阅读量'</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
    bcomment <span class="token operator">=</span> serializers<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>label<span class="token operator">=</span><span class="token string">'评论量'</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
    image <span class="token operator">=</span> serializers<span class="token punctuation">.</span>ImageField<span class="token punctuation">(</span>label<span class="token operator">=</span><span class="token string">'图片'</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
    heroinfo_set <span class="token operator">=</span> serializers<span class="token punctuation">.</span>PrimaryKeyRelatedField<span class="token punctuation">(</span>read_only<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> many<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>  <span class="token comment"># 新增</span>
</code></pre></div><p>使用效果：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> booktest<span class="token punctuation">.</span>serializers <span class="token keyword">import</span> BookInfoSerializer
<span class="token keyword">from</span> booktest<span class="token punctuation">.</span>models <span class="token keyword">import</span> BookInfo
book <span class="token operator">=</span> BookInfo<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
serializer <span class="token operator">=</span> BookInfoSerializer<span class="token punctuation">(</span>book<span class="token punctuation">)</span>
serializer<span class="token punctuation">.</span>data
<span class="token comment"># {'id': 2, 'btitle': '天龙八部', 'bpub_date': '1986-07-24', 'bread': 36, 'bcomment': 40, 'image': None, 'heroinfo_set': [6,8, 9]}</span>
</code></pre></div><p>[</p> <p>](../C03-Serializer/Declaring.html)</p> <h1 id="反序列化使用"><a href="#反序列化使用" class="header-anchor">#</a> 反序列化使用</h1> <h2 id="_1-验证"><a href="#_1-验证" class="header-anchor">#</a> 1. 验证</h2> <p>使用序列化器进行反序列化时，需要对数据进行验证后，才能获取验证成功的数据或保存成模型类对象。</p> <p>在获取反序列化的数据前，必须调用**is_valid()**方法进行验证，验证成功返回True，否则返回False。</p> <p>验证失败，可以通过序列化器对象的<strong>errors</strong>属性获取错误信息，返回字典，包含了字段和字段的错误。如果是非字段错误，可以通过修改REST framework配置中的<strong>NON_FIELD_ERRORS_KEY</strong>来控制错误字典中的键名。</p> <p>验证成功，可以通过序列化器对象的<strong>validated_data</strong>属性获取数据。</p> <p>在定义序列化器时，指明每个字段的序列化类型和选项参数，本身就是一种验证行为。</p> <p>如我们前面定义过的BookInfoSerializer</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">BookInfoSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>Serializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;图书数据序列化器&quot;&quot;&quot;</span>
    <span class="token builtin">id</span> <span class="token operator">=</span> serializers<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>label<span class="token operator">=</span><span class="token string">'ID'</span><span class="token punctuation">,</span> read_only<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    btitle <span class="token operator">=</span> serializers<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>label<span class="token operator">=</span><span class="token string">'名称'</span><span class="token punctuation">,</span> max_length<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span>
    bpub_date <span class="token operator">=</span> serializers<span class="token punctuation">.</span>DateField<span class="token punctuation">(</span>label<span class="token operator">=</span><span class="token string">'发布日期'</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    bread <span class="token operator">=</span> serializers<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>label<span class="token operator">=</span><span class="token string">'阅读量'</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
    bcomment <span class="token operator">=</span> serializers<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>label<span class="token operator">=</span><span class="token string">'评论量'</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
    image <span class="token operator">=</span> serializers<span class="token punctuation">.</span>ImageField<span class="token punctuation">(</span>label<span class="token operator">=</span><span class="token string">'图片'</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
</code></pre></div><p>通过构造序列化器对象，并将要反序列化的数据传递给data构造参数，进而进行验证</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> booktest<span class="token punctuation">.</span>serializers <span class="token keyword">import</span> BookInfoSerializer
data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'bpub_date'</span><span class="token punctuation">:</span> <span class="token number">123</span><span class="token punctuation">}</span>
serializer <span class="token operator">=</span> BookInfoSerializer<span class="token punctuation">(</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span>
serializer<span class="token punctuation">.</span>is_valid<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 返回False</span>
serializer<span class="token punctuation">.</span>errors
<span class="token comment"># {'btitle': [ErrorDetail(string='This field is required.', code='required')], 'bpub_date': [ErrorDetail(string='Date has wrong format. Use one of these formats instead: YYYY[-MM[-DD]].', code='invalid')]}</span>
serializer<span class="token punctuation">.</span>validated_data  <span class="token comment"># {}</span>

data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'btitle'</span><span class="token punctuation">:</span> <span class="token string">'python'</span><span class="token punctuation">,</span> <span class="token string">'bpub_date'</span><span class="token punctuation">:</span> <span class="token string">'1998-12-1'</span><span class="token punctuation">}</span>
serializer <span class="token operator">=</span> BookInfoSerializer<span class="token punctuation">(</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span>
serializer<span class="token punctuation">.</span>is_valid<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># True</span>
serializer<span class="token punctuation">.</span>errors  <span class="token comment"># {}</span>
serializer<span class="token punctuation">.</span>validated_data  <span class="token comment">#  OrderedDict([('btitle', 'python')])</span>
</code></pre></div><p>is_valid()方法还可以在验证失败时抛出异常serializers.ValidationError，可以通过传递<strong>raise_exception=True</strong>参数开启，REST framework接收到此异常，会向前端返回HTTP 400 Bad Request响应。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># Return a 400 response if the data was invalid.</span>
serializer<span class="token punctuation">.</span>is_valid<span class="token punctuation">(</span>raise_exception<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre></div><p>如果觉得这些还不够，需要再补充定义验证行为，可以使用以下三种方法：</p> <h4 id="_1-validate-field-name"><a href="#_1-validate-field-name" class="header-anchor">#</a> 1）<code>validate_&lt;field_name&gt;</code></h4> <p>对<code>&lt;field_name&gt;</code>字段进行验证，如</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">BookInfoSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>Serializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;图书数据序列化器&quot;&quot;&quot;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

    <span class="token keyword">def</span> <span class="token function">validate_btitle</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token string">'django'</span> <span class="token keyword">not</span> <span class="token keyword">in</span> value<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> serializers<span class="token punctuation">.</span>ValidationError<span class="token punctuation">(</span><span class="token string">&quot;图书不是关于Django的&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> value
</code></pre></div><p>测试</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> booktest<span class="token punctuation">.</span>serializers <span class="token keyword">import</span> BookInfoSerializer
data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'btitle'</span><span class="token punctuation">:</span> <span class="token string">'python'</span><span class="token punctuation">}</span>
serializer <span class="token operator">=</span> BookInfoSerializer<span class="token punctuation">(</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span>
serializer<span class="token punctuation">.</span>is_valid<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># False   </span>
serializer<span class="token punctuation">.</span>errors
<span class="token comment">#  {'btitle': [ErrorDetail(string='图书不是关于Django的', code='invalid')]}</span>
</code></pre></div><h4 id="_2-validate"><a href="#_2-validate" class="header-anchor">#</a> 2）validate</h4> <p>在序列化器中需要同时对多个字段进行比较验证时，可以定义validate方法来验证，如</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">BookInfoSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>Serializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;图书数据序列化器&quot;&quot;&quot;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

    <span class="token keyword">def</span> <span class="token function">validate</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> attrs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        bread <span class="token operator">=</span> attrs<span class="token punctuation">[</span><span class="token string">'bread'</span><span class="token punctuation">]</span>
        bcomment <span class="token operator">=</span> attrs<span class="token punctuation">[</span><span class="token string">'bcomment'</span><span class="token punctuation">]</span>
        <span class="token keyword">if</span> bread <span class="token operator">&lt;</span> bcomment<span class="token punctuation">:</span>
            <span class="token keyword">raise</span> serializers<span class="token punctuation">.</span>ValidationError<span class="token punctuation">(</span><span class="token string">'阅读量小于评论量'</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> attrs
</code></pre></div><p>测试</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> booktest<span class="token punctuation">.</span>serializers <span class="token keyword">import</span> BookInfoSerializer
data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'btitle'</span><span class="token punctuation">:</span> <span class="token string">'about django'</span><span class="token punctuation">,</span> <span class="token string">'bpub_date'</span><span class="token punctuation">:</span> <span class="token string">'1998-12-1'</span><span class="token punctuation">,</span> <span class="token string">'bread'</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token string">'bcomment'</span><span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">}</span>
s <span class="token operator">=</span> BookInfoSerializer<span class="token punctuation">(</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span>
s<span class="token punctuation">.</span>is_valid<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># False</span>
s<span class="token punctuation">.</span>errors
<span class="token comment">#  {'non_field_errors': [ErrorDetail(string='阅读量小于评论量', code='invalid')]}</span>
</code></pre></div><h4 id="_3-validators"><a href="#_3-validators" class="header-anchor">#</a> 3）validators</h4> <p>在字段中添加validators选项参数，也可以补充验证行为，如</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">about_django</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token string">'django'</span> <span class="token keyword">not</span> <span class="token keyword">in</span> value<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> serializers<span class="token punctuation">.</span>ValidationError<span class="token punctuation">(</span><span class="token string">&quot;图书不是关于Django的&quot;</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">BookInfoSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>Serializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;图书数据序列化器&quot;&quot;&quot;</span>
    <span class="token builtin">id</span> <span class="token operator">=</span> serializers<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>label<span class="token operator">=</span><span class="token string">'ID'</span><span class="token punctuation">,</span> read_only<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    btitle <span class="token operator">=</span> serializers<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>label<span class="token operator">=</span><span class="token string">'名称'</span><span class="token punctuation">,</span> max_length<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span> validators<span class="token operator">=</span><span class="token punctuation">[</span>about_django<span class="token punctuation">]</span><span class="token punctuation">)</span>
    bpub_date <span class="token operator">=</span> serializers<span class="token punctuation">.</span>DateField<span class="token punctuation">(</span>label<span class="token operator">=</span><span class="token string">'发布日期'</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    bread <span class="token operator">=</span> serializers<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>label<span class="token operator">=</span><span class="token string">'阅读量'</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
    bcomment <span class="token operator">=</span> serializers<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>label<span class="token operator">=</span><span class="token string">'评论量'</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
    image <span class="token operator">=</span> serializers<span class="token punctuation">.</span>ImageField<span class="token punctuation">(</span>label<span class="token operator">=</span><span class="token string">'图片'</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
</code></pre></div><p>测试：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> booktest<span class="token punctuation">.</span>serializers <span class="token keyword">import</span> BookInfoSerializer
data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'btitle'</span><span class="token punctuation">:</span> <span class="token string">'python'</span><span class="token punctuation">}</span>
serializer <span class="token operator">=</span> BookInfoSerializer<span class="token punctuation">(</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span>
serializer<span class="token punctuation">.</span>is_valid<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># False   </span>
serializer<span class="token punctuation">.</span>errors
<span class="token comment">#  {'btitle': [ErrorDetail(string='图书不是关于Django的', code='invalid')]}</span>
</code></pre></div><h2 id="_2-保存"><a href="#_2-保存" class="header-anchor">#</a> 2. 保存</h2> <p>如果在验证成功后，想要基于validated_data完成数据对象的创建，可以通过实现create()和update()两个方法来实现。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">BookInfoSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>Serializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;图书数据序列化器&quot;&quot;&quot;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

    <span class="token keyword">def</span> <span class="token function">create</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> validated_data<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;新建&quot;&quot;&quot;</span>
        <span class="token keyword">return</span> BookInfo<span class="token punctuation">(</span><span class="token operator">**</span>validated_data<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">update</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> instance<span class="token punctuation">,</span> validated_data<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;更新，instance为要更新的对象实例&quot;&quot;&quot;</span>
        instance<span class="token punctuation">.</span>btitle <span class="token operator">=</span> validated_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'btitle'</span><span class="token punctuation">,</span> instance<span class="token punctuation">.</span>btitle<span class="token punctuation">)</span>
        instance<span class="token punctuation">.</span>bpub_date <span class="token operator">=</span> validated_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'bpub_date'</span><span class="token punctuation">,</span> instance<span class="token punctuation">.</span>bpub_date<span class="token punctuation">)</span>
        instance<span class="token punctuation">.</span>bread <span class="token operator">=</span> validated_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'bread'</span><span class="token punctuation">,</span> instance<span class="token punctuation">.</span>bread<span class="token punctuation">)</span>
        instance<span class="token punctuation">.</span>bcomment <span class="token operator">=</span> validated_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'bcomment'</span><span class="token punctuation">,</span> instance<span class="token punctuation">.</span>bcomment<span class="token punctuation">)</span>
        <span class="token keyword">return</span> instance
</code></pre></div><p>如果需要在返回数据对象的时候，也将数据保存到数据库中，则可以进行如下修改</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">BookInfoSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>Serializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;图书数据序列化器&quot;&quot;&quot;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

    <span class="token keyword">def</span> <span class="token function">create</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> validated_data<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;新建&quot;&quot;&quot;</span>
        <span class="token keyword">return</span> BookInfo<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span><span class="token operator">**</span>validated_data<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">update</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> instance<span class="token punctuation">,</span> validated_data<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;更新，instance为要更新的对象实例&quot;&quot;&quot;</span>
        instance<span class="token punctuation">.</span>btitle <span class="token operator">=</span> validated_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'btitle'</span><span class="token punctuation">,</span> instance<span class="token punctuation">.</span>btitle<span class="token punctuation">)</span>
        instance<span class="token punctuation">.</span>bpub_date <span class="token operator">=</span> validated_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'bpub_date'</span><span class="token punctuation">,</span> instance<span class="token punctuation">.</span>bpub_date<span class="token punctuation">)</span>
        instance<span class="token punctuation">.</span>bread <span class="token operator">=</span> validated_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'bread'</span><span class="token punctuation">,</span> instance<span class="token punctuation">.</span>bread<span class="token punctuation">)</span>
        instance<span class="token punctuation">.</span>bcomment <span class="token operator">=</span> validated_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'bcomment'</span><span class="token punctuation">,</span> instance<span class="token punctuation">.</span>bcomment<span class="token punctuation">)</span>
        instance<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> instance
</code></pre></div><p>实现了上述两个方法后，在反序列化数据的时候，就可以通过save()方法返回一个数据对象实例了</p> <div class="language-python extra-class"><pre class="language-python"><code>book <span class="token operator">=</span> serializer<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>如果创建序列化器对象的时候，没有传递instance实例，则调用save()方法的时候，create()被调用，相反，如果传递了instance实例，则调用save()方法的时候，update()被调用。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> db<span class="token punctuation">.</span>serializers <span class="token keyword">import</span> BookInfoSerializer
data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'btitle'</span><span class="token punctuation">:</span> <span class="token string">'封神演义'</span><span class="token punctuation">,</span> <span class="token string">'bpub_date'</span><span class="token punctuation">:</span> <span class="token string">'1998-1-1'</span><span class="token punctuation">}</span>
serializer <span class="token operator">=</span> BookInfoSerializer<span class="token punctuation">(</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span>
serializer<span class="token punctuation">.</span>is_valid<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># True</span>
serializer<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># &lt;BookInfo: 封神演义&gt;</span>

<span class="token keyword">from</span> db<span class="token punctuation">.</span>models <span class="token keyword">import</span> BookInfo
book <span class="token operator">=</span> BookInfo<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'btitle'</span><span class="token punctuation">:</span> <span class="token string">'倚天剑'</span><span class="token punctuation">,</span> <span class="token string">'bpub_date'</span><span class="token punctuation">:</span> <span class="token string">'1998-12-18'</span><span class="token punctuation">}</span>
serializer <span class="token operator">=</span> BookInfoSerializer<span class="token punctuation">(</span>book<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>
serializer<span class="token punctuation">.</span>is_valid<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># True</span>
serializer<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># &lt;BookInfo: 倚天剑&gt;</span>
book<span class="token punctuation">.</span>btitle  <span class="token comment"># '倚天剑'</span>
</code></pre></div><h4 id="两点说明"><a href="#两点说明" class="header-anchor">#</a> 两点说明：</h4> <p>1） 在对序列化器进行save()保存时，可以额外传递数据，这些数据可以在create()和update()中的validated_data参数获取到</p> <div class="language-python extra-class"><pre class="language-python"><code>serializer<span class="token punctuation">.</span>save<span class="token punctuation">(</span>owner<span class="token operator">=</span>request<span class="token punctuation">.</span>user<span class="token punctuation">)</span>
</code></pre></div><p>2）默认序列化器必须传递所有required为True的字段，否则会抛出验证异常。但是我们可以使用partial参数来允许部分字段在<strong>更新</strong>操作时可以不传,而使用原有的数据</p> <div class="language-python extra-class"><pre class="language-python"><code>serializer <span class="token operator">=</span> BookInfoSerializer<span class="token punctuation">(</span>instance<span class="token operator">=</span>book<span class="token punctuation">,</span> data<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'btitle'</span><span class="token punctuation">:</span> <span class="token string">'hello django'</span><span class="token punctuation">,</span> <span class="token string">'bpub_date'</span><span class="token punctuation">:</span> book<span class="token punctuation">.</span>bpub_date<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment"># 两种写法最终效果等价</span>
serializer <span class="token operator">=</span> BookInfoSerializer<span class="token punctuation">(</span>instance<span class="token operator">=</span>book<span class="token punctuation">,</span> data<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'btitle'</span><span class="token punctuation">:</span> <span class="token string">'hello django'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> partial<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre></div><p>[</p> <p>](../C03-Serializer/Serializing.html)</p> <h1 id="模型类序列化器modelserializer"><a href="#模型类序列化器modelserializer" class="header-anchor">#</a> 模型类序列化器ModelSerializer</h1> <p>如果我们想要使用序列化器对应的是Django的模型类，DRF为我们提供了ModelSerializer模型类序列化器来帮助我们快速创建一个Serializer类。</p> <p>ModelSerializer与常规的Serializer相同，但提供了：</p> <ul><li>基于模型类自动生成一系列字段</li> <li>包含默认的create()和update()的实现</li></ul> <h2 id="_1-定义"><a href="#_1-定义" class="header-anchor">#</a> 1. 定义</h2> <p>比如我们创建一个BookInfoSerializer</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">BookInfoSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>ModelSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;图书数据序列化器&quot;&quot;&quot;</span>
    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        model <span class="token operator">=</span> BookInfo
        fields <span class="token operator">=</span> <span class="token string">'__all__'</span>
</code></pre></div><ul><li>model 指明参照哪个模型类</li> <li>fields 指明为模型类的哪些字段生成</li></ul> <p>我们可以在python manage.py shell中查看自动生成的BookInfoSerializer的具体实现</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">from</span> booktest<span class="token punctuation">.</span>serializers <span class="token keyword">import</span> BookInfoSerializer
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> serializer <span class="token operator">=</span> BookInfoSerializer<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> serializer
BookInfoSerializer<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token builtin">id</span> <span class="token operator">=</span> IntegerField<span class="token punctuation">(</span>label<span class="token operator">=</span><span class="token string">'ID'</span><span class="token punctuation">,</span> read_only<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    btitle <span class="token operator">=</span> CharField<span class="token punctuation">(</span>label<span class="token operator">=</span><span class="token string">'名称'</span><span class="token punctuation">,</span> max_length<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span>
    bpub_date <span class="token operator">=</span> DateField<span class="token punctuation">(</span>allow_null<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'发布日期'</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
    bread <span class="token operator">=</span> IntegerField<span class="token punctuation">(</span>label<span class="token operator">=</span><span class="token string">'阅读量'</span><span class="token punctuation">,</span> max_value<span class="token operator">=</span><span class="token number">2147483647</span><span class="token punctuation">,</span> min_value<span class="token operator">=</span><span class="token operator">-</span><span class="token number">2147483648</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
    bcomment <span class="token operator">=</span> IntegerField<span class="token punctuation">(</span>label<span class="token operator">=</span><span class="token string">'评论量'</span><span class="token punctuation">,</span> max_value<span class="token operator">=</span><span class="token number">2147483647</span><span class="token punctuation">,</span> min_value<span class="token operator">=</span><span class="token operator">-</span><span class="token number">2147483648</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
    image <span class="token operator">=</span> ImageField<span class="token punctuation">(</span>allow_null<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'图片'</span><span class="token punctuation">,</span> max_length<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="_2-指定字段"><a href="#_2-指定字段" class="header-anchor">#</a> 2. 指定字段</h2> <p>\1) 使用<strong>fields</strong>来明确字段，<code>__all__</code>表名包含所有字段，也可以写明具体哪些字段，如</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">BookInfoSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>ModelSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;图书数据序列化器&quot;&quot;&quot;</span>
    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        model <span class="token operator">=</span> BookInfo
        fields <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span> <span class="token string">'btitle'</span><span class="token punctuation">,</span> <span class="token string">'bpub_date'</span><span class="token punctuation">)</span>
</code></pre></div><p>\2) 使用<strong>exclude</strong>可以明确排除掉哪些字段</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">BookInfoSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>ModelSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;图书数据序列化器&quot;&quot;&quot;</span>
    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        model <span class="token operator">=</span> BookInfo
        exclude <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'image'</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
</code></pre></div><p>\3) 显示指明字段，如：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">HeroInfoSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>ModelSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    hbook <span class="token operator">=</span> BookInfoSerializer<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        model <span class="token operator">=</span> HeroInfo
        fields <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span> <span class="token string">'hname'</span><span class="token punctuation">,</span> <span class="token string">'hgender'</span><span class="token punctuation">,</span> <span class="token string">'hcomment'</span><span class="token punctuation">,</span> <span class="token string">'hbook'</span><span class="token punctuation">)</span>
</code></pre></div><p>\4) 指明只读字段</p> <p>可以通过<strong>read_only_fields</strong>指明只读字段，即仅用于序列化输出的字段</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">BookInfoSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>ModelSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;图书数据序列化器&quot;&quot;&quot;</span>
    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        model <span class="token operator">=</span> BookInfo
        fields <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span> <span class="token string">'btitle'</span><span class="token punctuation">,</span> <span class="token string">'bpub_date'</span>， <span class="token string">'bread'</span><span class="token punctuation">,</span> <span class="token string">'bcomment'</span><span class="token punctuation">)</span>
        read_only_fields <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span> <span class="token string">'bread'</span><span class="token punctuation">,</span> <span class="token string">'bcomment'</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="_3-添加额外参数"><a href="#_3-添加额外参数" class="header-anchor">#</a> 3. 添加额外参数</h2> <p>我们可以使用<strong>extra_kwargs</strong>参数为ModelSerializer添加或修改原有的选项参数</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">BookInfoSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>ModelSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;图书数据序列化器&quot;&quot;&quot;</span>
    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        model <span class="token operator">=</span> BookInfo
        fields <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span> <span class="token string">'btitle'</span><span class="token punctuation">,</span> <span class="token string">'bpub_date'</span><span class="token punctuation">,</span> <span class="token string">'bread'</span><span class="token punctuation">,</span> <span class="token string">'bcomment'</span><span class="token punctuation">)</span>
        extra_kwargs <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">'bread'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">'min_value'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'required'</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string">'bcomment'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">'min_value'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'required'</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>

<span class="token comment"># BookInfoSerializer():</span>
<span class="token comment">#    id = IntegerField(label='ID', read_only=True)</span>
<span class="token comment">#    btitle = CharField(label='名称', max_length=20)</span>
<span class="token comment">#    bpub_date = DateField(allow_null=True, label='发布日期', required=False)</span>
<span class="token comment">#    bread = IntegerField(label='阅读量', max_value=2147483647, min_value=0, required=True)</span>
<span class="token comment">#    bcomment = IntegerField(label='评论量', max_value=2147483647, min_value=0, required=True)</span>
</code></pre></div><h1 id="request-与-response"><a href="#request-与-response" class="header-anchor">#</a> Request 与 Response</h1> <h2 id="_1-request"><a href="#_1-request" class="header-anchor">#</a> 1. Request</h2> <p>REST framework 传入视图的request对象不再是Django默认的HttpRequest对象，而是REST framework提供的扩展了HttpRequest类的<strong>Request</strong>类的对象。</p> <p>REST framework 提供了<strong>Parser</strong>解析器，在接收到请求后会自动根据Content-Type指明的请求数据类型（如JSON、表单等）将请求数据进行parse解析，解析为类字典对象保存到<strong>Request</strong>对象中。</p> <p><strong>Request对象的数据是自动根据前端发送数据的格式进行解析之后的结果。</strong></p> <p>无论前端发送的哪种格式的数据，我们都可以以统一的方式读取数据。</p> <h3 id="常用属性"><a href="#常用属性" class="header-anchor">#</a> 常用属性</h3> <h4 id="_1-data"><a href="#_1-data" class="header-anchor">#</a> 1）.data</h4> <p><code>request.data</code> 返回解析之后的请求体数据。类似于Django中标准的<code>request.POST</code>和 <code>request.FILES</code>属性，但提供如下特性：</p> <ul><li>包含了解析之后的文件和非文件数据</li> <li>包含了对POST、PUT、PATCH请求方式解析后的数据</li> <li>利用了REST framework的parsers解析器，不仅支持表单类型数据，也支持JSON数据</li></ul> <h4 id="_2-query-params"><a href="#_2-query-params" class="header-anchor">#</a> 2）.query_params</h4> <p><code>request.query_params</code>与Django标准的<code>request.GET</code>相同，只是更换了更正确的名称而已。</p> <h2 id="_2-response"><a href="#_2-response" class="header-anchor">#</a> 2. Response</h2> <div class="language- extra-class"><pre class="language-text"><code>rest_framework.response.Response
</code></pre></div><p>REST framework提供了一个响应类<code>Response</code>，使用该类构造响应对象时，响应的具体数据内容会被转换（render渲染）成符合前端需求的类型。</p> <p>REST framework提供了<code>Renderer</code> 渲染器，用来根据请求头中的<code>Accept</code>（接收数据类型声明）来自动转换响应数据到对应格式。如果前端请求中未进行Accept声明，则会采用默认方式处理响应数据，我们可以通过配置来修改默认响应格式。</p> <div class="language-python extra-class"><pre class="language-python"><code>REST_FRAMEWORK <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'DEFAULT_RENDERER_CLASSES'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>  <span class="token comment"># 默认响应渲染类</span>
        <span class="token string">'rest_framework.renderers.JSONRenderer'</span><span class="token punctuation">,</span>  <span class="token comment"># json渲染器</span>
        <span class="token string">'rest_framework.renderers.BrowsableAPIRenderer'</span><span class="token punctuation">,</span>  <span class="token comment"># 浏览API渲染器</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="构造方式"><a href="#构造方式" class="header-anchor">#</a> 构造方式</h3> <div class="language-python extra-class"><pre class="language-python"><code>Response<span class="token punctuation">(</span>data<span class="token punctuation">,</span> status<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> template_name<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> headers<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> content_type<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>
</code></pre></div><p><code>data</code>数据不要是render处理之后的数据，只需传递python的内建类型数据即可，REST framework会使用<code>renderer</code>渲染器处理<code>data</code>。</p> <p><code>data</code>不能是复杂结构的数据，如Django的模型类对象，对于这样的数据我们可以使用<code>Serializer</code>序列化器序列化处理后（转为了Python字典类型）再传递给<code>data</code>参数。</p> <p>参数说明：</p> <ul><li><code>data</code>: 为响应准备的序列化处理后的数据；</li> <li><code>status</code>: 状态码，默认200；</li> <li><code>template_name</code>: 模板名称，如果使用<code>HTMLRenderer</code> 时需指明；</li> <li><code>headers</code>: 用于存放响应头信息的字典；</li> <li><code>content_type</code>: 响应数据的Content-Type，通常此参数无需传递，REST framework会根据前端所需类型数据来设置该参数。</li></ul> <h4 id="常用属性-2"><a href="#常用属性-2" class="header-anchor">#</a> 常用属性：</h4> <h5 id="_1-data-2"><a href="#_1-data-2" class="header-anchor">#</a> 1）.data</h5> <p>传给response对象的序列化后，但尚未render处理的数据</p> <h5 id="_2-status-code"><a href="#_2-status-code" class="header-anchor">#</a> 2）.status_code</h5> <p>状态码的数字</p> <h5 id="_3-content"><a href="#_3-content" class="header-anchor">#</a> 3）.content</h5> <p>经过render处理后的响应数据</p> <h2 id="_3-状态码"><a href="#_3-状态码" class="header-anchor">#</a> 3. 状态码</h2> <p>为了方便设置状态码，REST framewrok在<code>rest_framework.status</code>模块中提供了常用状态码常量。</p> <h5 id="_1-信息告知-1xx"><a href="#_1-信息告知-1xx" class="header-anchor">#</a> 1）信息告知 - 1xx</h5> <div class="language-python extra-class"><pre class="language-python"><code>HTTP_100_CONTINUE
HTTP_101_SWITCHING_PROTOCOLS
</code></pre></div><h5 id="_2-成功-2xx"><a href="#_2-成功-2xx" class="header-anchor">#</a> 2）成功 - 2xx</h5> <div class="language-python extra-class"><pre class="language-python"><code>HTTP_200_OK
HTTP_201_CREATED
HTTP_202_ACCEPTED
HTTP_203_NON_AUTHORITATIVE_INFORMATION
HTTP_204_NO_CONTENT
HTTP_205_RESET_CONTENT
HTTP_206_PARTIAL_CONTENT
HTTP_207_MULTI_STATUS
</code></pre></div><h5 id="_3-重定向-3xx"><a href="#_3-重定向-3xx" class="header-anchor">#</a> 3）重定向 - 3xx</h5> <div class="language-python extra-class"><pre class="language-python"><code>HTTP_300_MULTIPLE_CHOICES
HTTP_301_MOVED_PERMANENTLY
HTTP_302_FOUND
HTTP_303_SEE_OTHER
HTTP_304_NOT_MODIFIED
HTTP_305_USE_PROXY
HTTP_306_RESERVED
HTTP_307_TEMPORARY_REDIRECT
</code></pre></div><h5 id="_4-客户端错误-4xx"><a href="#_4-客户端错误-4xx" class="header-anchor">#</a> 4）客户端错误 - 4xx</h5> <div class="language-python extra-class"><pre class="language-python"><code>HTTP_400_BAD_REQUEST
HTTP_401_UNAUTHORIZED
HTTP_402_PAYMENT_REQUIRED
HTTP_403_FORBIDDEN
HTTP_404_NOT_FOUND
HTTP_405_METHOD_NOT_ALLOWED
HTTP_406_NOT_ACCEPTABLE
HTTP_407_PROXY_AUTHENTICATION_REQUIRED
HTTP_408_REQUEST_TIMEOUT
HTTP_409_CONFLICT
HTTP_410_GONE
HTTP_411_LENGTH_REQUIRED
HTTP_412_PRECONDITION_FAILED
HTTP_413_REQUEST_ENTITY_TOO_LARGE
HTTP_414_REQUEST_URI_TOO_LONG
HTTP_415_UNSUPPORTED_MEDIA_TYPE
HTTP_416_REQUESTED_RANGE_NOT_SATISFIABLE
HTTP_417_EXPECTATION_FAILED
HTTP_422_UNPROCESSABLE_ENTITY
HTTP_423_LOCKED
HTTP_424_FAILED_DEPENDENCY
HTTP_428_PRECONDITION_REQUIRED
HTTP_429_TOO_MANY_REQUESTS
HTTP_431_REQUEST_HEADER_FIELDS_TOO_LARGE
HTTP_451_UNAVAILABLE_FOR_LEGAL_REASONS
</code></pre></div><h5 id="_5-服务器错误-5xx"><a href="#_5-服务器错误-5xx" class="header-anchor">#</a> 5）服务器错误 - 5xx</h5> <div class="language-python extra-class"><pre class="language-python"><code>HTTP_500_INTERNAL_SERVER_ERROR
HTTP_501_NOT_IMPLEMENTED
HTTP_502_BAD_GATEWAY
HTTP_503_SERVICE_UNAVAILABLE
HTTP_504_GATEWAY_TIMEOUT
HTTP_505_HTTP_VERSION_NOT_SUPPORTED
HTTP_507_INSUFFICIENT_STORAGE
HTTP_511_NETWORK_AUTHENTICATION_REQUIRED
</code></pre></div><h1 id="视图概览"><a href="#视图概览" class="header-anchor">#</a> 视图概览</h1> <p>REST framework 提供了众多的通用视图基类与扩展类，以简化视图的编写。</p> <p>视图的继承关系：</p> <p><img src="/image/drf/%E9%80%9A%E7%94%A8%E8%A7%86%E5%9B%BE%E7%9A%84%E7%BB%A7%E6%89%BF%E5%85%B3%E7%B3%BB.png" alt="通用视图的继承关系"></p> <p>视图的方法与属性：</p> <p><img src="/image/drf/%E9%80%9A%E7%94%A8%E8%A7%86%E5%9B%BE%E7%9A%84%E7%BB%A7%E6%89%BF%E5%85%B3%E7%B3%BB_%E5%90%AB%E6%96%B9%E6%B3%95%E5%92%8C%E5%B1%9E%E6%80%A7.png" alt="通用视图的继承关系_含方法和属性"></p> <h1 id="视图说明"><a href="#视图说明" class="header-anchor">#</a> 视图说明</h1> <h2 id="_1-两个基类"><a href="#_1-两个基类" class="header-anchor">#</a> 1. 两个基类</h2> <h3 id="_1-apiview"><a href="#_1-apiview" class="header-anchor">#</a> 1）APIView</h3> <div class="language- extra-class"><pre class="language-text"><code>rest_framework.views.APIView
</code></pre></div><p><code>APIView</code>是REST framework提供的所有视图的基类，继承自Django的<code>View</code>父类。</p> <p><code>APIView</code>与<code>View</code>的不同之处在于：</p> <ul><li>传入到视图方法中的是REST framework的<code>Request</code>对象，而不是Django的<code>HttpRequeset</code>对象；</li> <li>视图方法可以返回REST framework的<code>Response</code>对象，视图会为响应数据设置（render）符合前端要求的格式；</li> <li>任何<code>APIException</code>异常都会被捕获到，并且处理成合适的响应信息；</li> <li>在进行dispatch()分发前，会对请求进行身份认证、权限检查、流量控制。</li></ul> <h5 id="支持定义的属性"><a href="#支持定义的属性" class="header-anchor">#</a> 支持定义的属性：</h5> <ul><li><strong>authentication_classes</strong> 列表或元组，身份认证类</li> <li><strong>permissoin_classes</strong> 列表或元组，权限检查类</li> <li><strong>throttle_classes</strong> 列表或元组，流量控制类</li></ul> <p>在<code>APIView</code>中仍以常规的类视图定义方法来实现get() 、post() 或者其他请求方式的方法。</p> <p>举例：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>views <span class="token keyword">import</span> APIView
<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>response <span class="token keyword">import</span> Response

<span class="token comment"># url(r'^books/$', views.BookListView.as_view()),</span>
<span class="token keyword">class</span> <span class="token class-name">BookListView</span><span class="token punctuation">(</span>APIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span>
        books <span class="token operator">=</span> BookInfo<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        serializer <span class="token operator">=</span> BookInfoSerializer<span class="token punctuation">(</span>books<span class="token punctuation">,</span> many<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> Response<span class="token punctuation">(</span>serializer<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
</code></pre></div><h3 id="_2-genericapiview"><a href="#_2-genericapiview" class="header-anchor">#</a> 2）GenericAPIView</h3> <div class="language- extra-class"><pre class="language-text"><code>rest_framework.generics.GenericAPIView
</code></pre></div><p>继承自<code>APIVIew</code>，<strong>主要增加了操作序列化器和数据库查询的方法，作用是为下面Mixin扩展类的执行提供方法支持。通常在使用时，可搭配一个或多个Mixin扩展类。</strong></p> <h4 id="提供的关于序列化器使用的属性与方法"><a href="#提供的关于序列化器使用的属性与方法" class="header-anchor">#</a> 提供的关于序列化器使用的属性与方法</h4> <ul><li><p>属性：</p> <ul><li><strong>serializer_class</strong> 指明视图使用的序列化器</li></ul></li> <li><p>方法：</p> <ul><li><p><strong>get_serializer_class(self)</strong></p> <p>返回序列化器类，默认返回<code>serializer_class</code>，可以重写，例如：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">get_serializer_class</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> self<span class="token punctuation">.</span>request<span class="token punctuation">.</span>user<span class="token punctuation">.</span>is_staff<span class="token punctuation">:</span>
        <span class="token keyword">return</span> FullAccountSerializer
    <span class="token keyword">return</span> BasicAccountSerializer
</code></pre></div></li> <li><h5 id="get-serializer-self-args-kwargs"><a href="#get-serializer-self-args-kwargs" class="header-anchor">#</a> get_serializer(self, *args, **kwargs)</h5> <p>返回序列化器对象，主要用来提供给Mixin扩展类使用，如果我们在视图中想要获取序列化器对象，也可以直接调用此方法。</p> <p><strong>注意，该方法在提供序列化器对象的时候，会向序列化器对象的context属性补充三个数据：request、format、view，这三个数据对象可以在定义序列化器时使用。</strong></p> <ul><li><strong>request</strong> 当前视图的请求对象</li> <li><strong>view</strong> 当前请求的类视图对象</li> <li>format 当前请求期望返回的数据格式</li></ul></li></ul></li></ul> <h4 id="提供的关于数据库查询的属性与方法"><a href="#提供的关于数据库查询的属性与方法" class="header-anchor">#</a> 提供的关于数据库查询的属性与方法</h4> <ul><li><p>属性：</p> <ul><li><strong>queryset</strong> 指明使用的数据查询集</li></ul></li> <li><p>方法：</p> <ul><li><p><strong>get_queryset(self)</strong></p> <p>返回视图使用的查询集，主要用来提供给Mixin扩展类使用，是列表视图与详情视图获取数据的基础，默认返回<code>queryset</code>属性，可以重写，例如：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">get_queryset</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    user <span class="token operator">=</span> self<span class="token punctuation">.</span>request<span class="token punctuation">.</span>user
    <span class="token keyword">return</span> user<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p><strong>get_object(self)</strong></p> <p>返回详情视图所需的模型类数据对象，主要用来提供给Mixin扩展类使用。</p> <p>在试图中可以调用该方法获取详情信息的模型类对象。</p> <p><strong>若详情访问的模型类对象不存在，会返回404。</strong></p> <p>该方法会默认使用APIView提供的check_object_permissions方法检查当前对象是否有权限被访问。</p> <p>举例：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># url(r'^books/(?P&lt;pk&gt;\d+)/$', views.BookDetailView.as_view()),</span>
<span class="token keyword">class</span> <span class="token class-name">BookDetailView</span><span class="token punctuation">(</span>GenericAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    queryset <span class="token operator">=</span> BookInfo<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    serializer_class <span class="token operator">=</span> BookInfoSerializer

    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> pk<span class="token punctuation">)</span><span class="token punctuation">:</span>
        book <span class="token operator">=</span> self<span class="token punctuation">.</span>get_object<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># get_object()方法根据pk参数查找queryset中的数据对象</span>
        serializer <span class="token operator">=</span> self<span class="token punctuation">.</span>get_serializer<span class="token punctuation">(</span>book<span class="token punctuation">)</span>
        <span class="token keyword">return</span> Response<span class="token punctuation">(</span>serializer<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
</code></pre></div></li></ul></li></ul> <h4 id="其他可以设置的属性"><a href="#其他可以设置的属性" class="header-anchor">#</a> 其他可以设置的属性</h4> <ul><li><strong>pagination_class</strong> 指明分页控制类</li> <li><strong>filter_backends</strong> 指明过滤控制后端</li></ul> <h2 id="_2-五个扩展类"><a href="#_2-五个扩展类" class="header-anchor">#</a> 2. 五个扩展类</h2> <h4 id="作用"><a href="#作用" class="header-anchor">#</a> 作用：</h4> <p>提供了几种后端视图（对数据资源进行曾删改查）处理流程的实现，如果需要编写的视图属于这五种，则视图可以通过继承相应的扩展类来复用代码，减少自己编写的代码量。</p> <p>这五个扩展类需要搭配GenericAPIView父类，因为五个扩展类的实现需要调用GenericAPIView提供的序列化器与数据库查询的方法。</p> <h3 id="_1-listmodelmixin"><a href="#_1-listmodelmixin" class="header-anchor">#</a> 1）ListModelMixin</h3> <p>列表视图扩展类，提供<code>list(request, *args, **kwargs)</code>方法快速实现列表视图，返回200状态码。</p> <p>该Mixin的list方法会对数据进行过滤和分页。</p> <p>源代码：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">ListModelMixin</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;
    List a queryset.
    &quot;&quot;&quot;</span>
    <span class="token keyword">def</span> <span class="token function">list</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 过滤</span>
        queryset <span class="token operator">=</span> self<span class="token punctuation">.</span>filter_queryset<span class="token punctuation">(</span>self<span class="token punctuation">.</span>get_queryset<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment"># 分页</span>
        page <span class="token operator">=</span> self<span class="token punctuation">.</span>paginate_queryset<span class="token punctuation">(</span>queryset<span class="token punctuation">)</span>
        <span class="token keyword">if</span> page <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            serializer <span class="token operator">=</span> self<span class="token punctuation">.</span>get_serializer<span class="token punctuation">(</span>page<span class="token punctuation">,</span> many<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>get_paginated_response<span class="token punctuation">(</span>serializer<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
        <span class="token comment"># 序列化</span>
        serializer <span class="token operator">=</span> self<span class="token punctuation">.</span>get_serializer<span class="token punctuation">(</span>queryset<span class="token punctuation">,</span> many<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> Response<span class="token punctuation">(</span>serializer<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
</code></pre></div><p>举例：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>mixins <span class="token keyword">import</span> ListModelMixin

<span class="token keyword">class</span> <span class="token class-name">BookListView</span><span class="token punctuation">(</span>ListModelMixin<span class="token punctuation">,</span> GenericAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    queryset <span class="token operator">=</span> BookInfo<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    serializer_class <span class="token operator">=</span> BookInfoSerializer

    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span><span class="token builtin">list</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span>
</code></pre></div><h3 id="_2-createmodelmixin"><a href="#_2-createmodelmixin" class="header-anchor">#</a> 2）CreateModelMixin</h3> <p>创建视图扩展类，提供<code>create(request, *args, **kwargs)</code>方法快速实现创建资源的视图，成功返回201状态码。</p> <p>如果序列化器对前端发送的数据验证失败，返回400错误。</p> <p>源代码：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">CreateModelMixin</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;
    Create a model instance.
    &quot;&quot;&quot;</span>
    <span class="token keyword">def</span> <span class="token function">create</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 获取序列化器</span>
        serializer <span class="token operator">=</span> self<span class="token punctuation">.</span>get_serializer<span class="token punctuation">(</span>data<span class="token operator">=</span>request<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
        <span class="token comment"># 验证</span>
        serializer<span class="token punctuation">.</span>is_valid<span class="token punctuation">(</span>raise_exception<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        <span class="token comment"># 保存</span>
        self<span class="token punctuation">.</span>perform_create<span class="token punctuation">(</span>serializer<span class="token punctuation">)</span>
        headers <span class="token operator">=</span> self<span class="token punctuation">.</span>get_success_headers<span class="token punctuation">(</span>serializer<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
        <span class="token keyword">return</span> Response<span class="token punctuation">(</span>serializer<span class="token punctuation">.</span>data<span class="token punctuation">,</span> status<span class="token operator">=</span>status<span class="token punctuation">.</span>HTTP_201_CREATED<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">perform_create</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> serializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
        serializer<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">get_success_headers</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token string">'Location'</span><span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span>api_settings<span class="token punctuation">.</span>URL_FIELD_NAME<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token keyword">except</span> <span class="token punctuation">(</span>TypeError<span class="token punctuation">,</span> KeyError<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><h3 id="_3-retrievemodelmixin"><a href="#_3-retrievemodelmixin" class="header-anchor">#</a> 3） RetrieveModelMixin</h3> <p>详情视图扩展类，提供<code>retrieve(request, *args, **kwargs)</code>方法，可以快速实现返回一个存在的数据对象。</p> <p>如果存在，返回200， 否则返回404。</p> <p>源代码：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">RetrieveModelMixin</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;
    Retrieve a model instance.
    &quot;&quot;&quot;</span>
    <span class="token keyword">def</span> <span class="token function">retrieve</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 获取对象，会检查对象的权限</span>
        instance <span class="token operator">=</span> self<span class="token punctuation">.</span>get_object<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment"># 序列化</span>
        serializer <span class="token operator">=</span> self<span class="token punctuation">.</span>get_serializer<span class="token punctuation">(</span>instance<span class="token punctuation">)</span>
        <span class="token keyword">return</span> Response<span class="token punctuation">(</span>serializer<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
</code></pre></div><p>举例：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">BookDetailView</span><span class="token punctuation">(</span>RetrieveModelMixin<span class="token punctuation">,</span> GenericAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    queryset <span class="token operator">=</span> BookInfo<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    serializer_class <span class="token operator">=</span> BookInfoSerializer

    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> pk<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>retrieve<span class="token punctuation">(</span>request<span class="token punctuation">)</span>
</code></pre></div><h3 id="_4-updatemodelmixin"><a href="#_4-updatemodelmixin" class="header-anchor">#</a> 4）UpdateModelMixin</h3> <p>更新视图扩展类，提供<code>update(request, *args, **kwargs)</code>方法，可以快速实现更新一个存在的数据对象。</p> <p>同时也提供<code>partial_update(request, *args, **kwargs)</code>方法，可以实现局部更新。</p> <p>成功返回200，序列化器校验数据失败时，返回400错误。</p> <p>源代码：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">UpdateModelMixin</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;
    Update a model instance.
    &quot;&quot;&quot;</span>
    <span class="token keyword">def</span> <span class="token function">update</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        partial <span class="token operator">=</span> kwargs<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">'partial'</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span>
        instance <span class="token operator">=</span> self<span class="token punctuation">.</span>get_object<span class="token punctuation">(</span><span class="token punctuation">)</span>
        serializer <span class="token operator">=</span> self<span class="token punctuation">.</span>get_serializer<span class="token punctuation">(</span>instance<span class="token punctuation">,</span> data<span class="token operator">=</span>request<span class="token punctuation">.</span>data<span class="token punctuation">,</span> partial<span class="token operator">=</span>partial<span class="token punctuation">)</span>
        serializer<span class="token punctuation">.</span>is_valid<span class="token punctuation">(</span>raise_exception<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>perform_update<span class="token punctuation">(</span>serializer<span class="token punctuation">)</span>

        <span class="token keyword">if</span> <span class="token builtin">getattr</span><span class="token punctuation">(</span>instance<span class="token punctuation">,</span> <span class="token string">'_prefetched_objects_cache'</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment"># If 'prefetch_related' has been applied to a queryset, we need to</span>
            <span class="token comment"># forcibly invalidate the prefetch cache on the instance.</span>
            instance<span class="token punctuation">.</span>_prefetched_objects_cache <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

        <span class="token keyword">return</span> Response<span class="token punctuation">(</span>serializer<span class="token punctuation">.</span>data<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">perform_update</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> serializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
        serializer<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">partial_update</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        kwargs<span class="token punctuation">[</span><span class="token string">'partial'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">True</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>update<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
</code></pre></div><h3 id="_5-destroymodelmixin"><a href="#_5-destroymodelmixin" class="header-anchor">#</a> 5）DestroyModelMixin</h3> <p>删除视图扩展类，提供<code>destroy(request, *args, **kwargs)</code>方法，可以快速实现删除一个存在的数据对象。</p> <p>成功返回204，不存在返回404。</p> <p>源代码：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">DestroyModelMixin</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;
    Destroy a model instance.
    &quot;&quot;&quot;</span>
    <span class="token keyword">def</span> <span class="token function">destroy</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        instance <span class="token operator">=</span> self<span class="token punctuation">.</span>get_object<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>perform_destroy<span class="token punctuation">(</span>instance<span class="token punctuation">)</span>
        <span class="token keyword">return</span> Response<span class="token punctuation">(</span>status<span class="token operator">=</span>status<span class="token punctuation">.</span>HTTP_204_NO_CONTENT<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">perform_destroy</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> instance<span class="token punctuation">)</span><span class="token punctuation">:</span>
        instance<span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="_3-几个可用子类视图"><a href="#_3-几个可用子类视图" class="header-anchor">#</a> 3. 几个可用子类视图</h2> <h3 id="_1-createapiview"><a href="#_1-createapiview" class="header-anchor">#</a> 1） CreateAPIView</h3> <p>提供 post 方法</p> <p>继承自： GenericAPIView、CreateModelMixin</p> <h3 id="_2-listapiview"><a href="#_2-listapiview" class="header-anchor">#</a> 2）ListAPIView</h3> <p>提供 get 方法</p> <p>继承自：GenericAPIView、ListModelMixin</p> <h3 id="_3-retrieveapiview"><a href="#_3-retrieveapiview" class="header-anchor">#</a> 3）RetrieveAPIView</h3> <p>提供 get 方法</p> <p>继承自: GenericAPIView、RetrieveModelMixin</p> <h3 id="_4-destoryapiview"><a href="#_4-destoryapiview" class="header-anchor">#</a> 4）DestoryAPIView</h3> <p>提供 delete 方法</p> <p>继承自：GenericAPIView、DestoryModelMixin</p> <h3 id="_5-updateapiview"><a href="#_5-updateapiview" class="header-anchor">#</a> 5）UpdateAPIView</h3> <p>提供 put 和 patch 方法</p> <p>继承自：GenericAPIView、UpdateModelMixin</p> <h3 id="_6-retrieveupdateapiview"><a href="#_6-retrieveupdateapiview" class="header-anchor">#</a> 6）RetrieveUpdateAPIView</h3> <p>提供 get、put、patch方法</p> <p>继承自： GenericAPIView、RetrieveModelMixin、UpdateModelMixin</p> <h3 id="_7-retrieveupdatedestoryapiview"><a href="#_7-retrieveupdatedestoryapiview" class="header-anchor">#</a> 7）RetrieveUpdateDestoryAPIView</h3> <p>提供 get、put、patch、delete方法</p> <p>继承自：GenericAPIView、RetrieveModelMixin、UpdateModelMixin、DestoryModelMixin</p> <h1 id="视图集viewset"><a href="#视图集viewset" class="header-anchor">#</a> 视图集ViewSet</h1> <p>使用视图集ViewSet，可以将一系列逻辑相关的动作放到一个类中：</p> <ul><li>list() 提供一组数据</li> <li>retrieve() 提供单个数据</li> <li>create() 创建数据</li> <li>update() 保存数据</li> <li>destory() 删除数据</li></ul> <p>ViewSet视图集类不再实现get()、post()等方法，而是实现动作 <strong>action</strong> 如 list() 、create() 等。</p> <p>视图集只在使用as_view()方法的时候，才会将<strong>action</strong>动作与具体请求方式对应上。如：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">BookInfoViewSet</span><span class="token punctuation">(</span>viewsets<span class="token punctuation">.</span>ViewSet<span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">def</span> <span class="token function">list</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span>
        books <span class="token operator">=</span> BookInfo<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        serializer <span class="token operator">=</span> BookInfoSerializer<span class="token punctuation">(</span>books<span class="token punctuation">,</span> many<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> Response<span class="token punctuation">(</span>serializer<span class="token punctuation">.</span>data<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">retrieve</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> pk<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            books <span class="token operator">=</span> BookInfo<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span>pk<span class="token punctuation">)</span>
        <span class="token keyword">except</span> BookInfo<span class="token punctuation">.</span>DoesNotExist<span class="token punctuation">:</span>
            <span class="token keyword">return</span> Response<span class="token punctuation">(</span>status<span class="token operator">=</span>status<span class="token punctuation">.</span>HTTP_404_NOT_FOUND<span class="token punctuation">)</span>
        serializer <span class="token operator">=</span> BookInfoSerializer<span class="token punctuation">(</span>books<span class="token punctuation">)</span>
        <span class="token keyword">return</span> Response<span class="token punctuation">(</span>serializer<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
</code></pre></div><p>在设置路由时，我们可以如下操作</p> <div class="language-python extra-class"><pre class="language-python"><code>urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>
    url<span class="token punctuation">(</span><span class="token string">r'^books/$'</span><span class="token punctuation">,</span> BookInfoViewSet<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'get'</span><span class="token punctuation">:</span><span class="token string">'list'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    url<span class="token punctuation">(</span><span class="token string">r'^books/(?P&lt;pk&gt;\d+)/$'</span><span class="token punctuation">,</span> BookInfoViewSet<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'get'</span><span class="token punctuation">:</span> <span class="token string">'retrieve'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre></div><h2 id="_1-常用视图集父类"><a href="#_1-常用视图集父类" class="header-anchor">#</a> 1. 常用视图集父类</h2> <h4 id="_1-viewset"><a href="#_1-viewset" class="header-anchor">#</a> 1） ViewSet</h4> <p>继承自<code>APIView</code>与<code>ViewSetMixin</code>，作用也与APIView基本类似，提供了身份认证、权限校验、流量管理等。</p> <p><strong>ViewSet主要通过继承ViewSetMixin来实现在调用as_view()时传入字典（如<code>{'get':'list'}</code>）的映射处理工作。</strong></p> <p>在ViewSet中，没有提供任何动作action方法，需要我们自己实现action方法。</p> <h4 id="_2-genericviewset"><a href="#_2-genericviewset" class="header-anchor">#</a> 2）GenericViewSet</h4> <p>使用ViewSet通常并不方便，因为list、retrieve、create、update、destory等方法都需要自己编写，而这些方法与前面讲过的Mixin扩展类提供的方法同名，所以我们可以通过继承Mixin扩展类来复用这些方法而无需自己编写。但是Mixin扩展类依赖与<code>GenericAPIView</code>，所以还需要继承<code>GenericAPIView</code>。</p> <p><strong>GenericViewSet</strong>就帮助我们完成了这样的继承工作，继承自<code>GenericAPIView</code>与<code>ViewSetMixin</code>，在实现了调用as_view()时传入字典（如<code>{'get':'list'}</code>）的映射处理工作的同时，还提供了<code>GenericAPIView</code>提供的基础方法，可以直接搭配Mixin扩展类使用。</p> <p>举例：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> mixins
<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>viewsets <span class="token keyword">import</span> GenericViewSet
<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>decorators <span class="token keyword">import</span> action

<span class="token keyword">class</span> <span class="token class-name">BookInfoViewSet</span><span class="token punctuation">(</span>mixins<span class="token punctuation">.</span>ListModelMixin<span class="token punctuation">,</span> mixins<span class="token punctuation">.</span>RetrieveModelMixin<span class="token punctuation">,</span> GenericViewSet<span class="token punctuation">)</span><span class="token punctuation">:</span>
    queryset <span class="token operator">=</span> BookInfo<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    serializer_class <span class="token operator">=</span> BookInfoSerializer
</code></pre></div><p>url的定义</p> <div class="language-python extra-class"><pre class="language-python"><code>urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>
    url<span class="token punctuation">(</span><span class="token string">r'^books/$'</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>BookInfoViewSet<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'get'</span><span class="token punctuation">:</span> <span class="token string">'list'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    url<span class="token punctuation">(</span><span class="token string">r'^books/(?P&lt;pk&gt;\d+)/$'</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>BookInfoViewSet<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'get'</span><span class="token punctuation">:</span> <span class="token string">'retrieve'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre></div><h4 id="_3-modelviewset"><a href="#_3-modelviewset" class="header-anchor">#</a> 3）ModelViewSet</h4> <p>继承自<code>GenericViewSet</code>，同时包括了ListModelMixin、RetrieveModelMixin、CreateModelMixin、UpdateModelMixin、DestoryModelMixin。</p> <h4 id="_4-readonlymodelviewset"><a href="#_4-readonlymodelviewset" class="header-anchor">#</a> 4）ReadOnlyModelViewSet</h4> <p>继承自<code>GenericViewSet</code>，同时包括了ListModelMixin、RetrieveModelMixin。</p> <h2 id="_2-视图集中定义附加action动作"><a href="#_2-视图集中定义附加action动作" class="header-anchor">#</a> 2. 视图集中定义附加action动作</h2> <p>在视图集中，除了上述默认的方法动作外，还可以添加自定义动作。</p> <p>举例：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> mixins
<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>viewsets <span class="token keyword">import</span> GenericViewSet
<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>decorators <span class="token keyword">import</span> action

<span class="token keyword">class</span> <span class="token class-name">BookInfoViewSet</span><span class="token punctuation">(</span>mixins<span class="token punctuation">.</span>ListModelMixin<span class="token punctuation">,</span> mixins<span class="token punctuation">.</span>RetrieveModelMixin<span class="token punctuation">,</span> GenericViewSet<span class="token punctuation">)</span><span class="token punctuation">:</span>
    queryset <span class="token operator">=</span> BookInfo<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    serializer_class <span class="token operator">=</span> BookInfoSerializer

    <span class="token keyword">def</span> <span class="token function">latest</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        返回最新的图书信息
        &quot;&quot;&quot;</span>
        book <span class="token operator">=</span> BookInfo<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>latest<span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span>
        serializer <span class="token operator">=</span> self<span class="token punctuation">.</span>get_serializer<span class="token punctuation">(</span>book<span class="token punctuation">)</span>
        <span class="token keyword">return</span> Response<span class="token punctuation">(</span>serializer<span class="token punctuation">.</span>data<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">read</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> pk<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        修改图书的阅读量数据
        &quot;&quot;&quot;</span>
        book <span class="token operator">=</span> self<span class="token punctuation">.</span>get_object<span class="token punctuation">(</span><span class="token punctuation">)</span>
        book<span class="token punctuation">.</span>bread <span class="token operator">=</span> request<span class="token punctuation">.</span>data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'bread'</span><span class="token punctuation">)</span>
        book<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>
        serializer <span class="token operator">=</span> self<span class="token punctuation">.</span>get_serializer<span class="token punctuation">(</span>book<span class="token punctuation">)</span>
        <span class="token keyword">return</span> Response<span class="token punctuation">(</span>serializer<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
</code></pre></div><p>url的定义</p> <div class="language-python extra-class"><pre class="language-python"><code>urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>
    url<span class="token punctuation">(</span><span class="token string">r'^books/$'</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>BookInfoViewSet<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'get'</span><span class="token punctuation">:</span> <span class="token string">'list'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    url<span class="token punctuation">(</span><span class="token string">r'^books/latest/$'</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>BookInfoViewSet<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'get'</span><span class="token punctuation">:</span> <span class="token string">'latest'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    url<span class="token punctuation">(</span><span class="token string">r'^books/(?P&lt;pk&gt;\d+)/$'</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>BookInfoViewSet<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'get'</span><span class="token punctuation">:</span> <span class="token string">'retrieve'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    url<span class="token punctuation">(</span><span class="token string">r'^books/(?P&lt;pk&gt;\d+)/read/$'</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>BookInfoViewSet<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'put'</span><span class="token punctuation">:</span> <span class="token string">'read'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre></div><h2 id="_3-action属性"><a href="#_3-action属性" class="header-anchor">#</a> 3. action属性</h2> <p>在视图集中，我们可以通过action对象属性来获取当前请求视图集时的action动作是哪个。</p> <p>例如：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">get_serializer_class</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> self<span class="token punctuation">.</span>action <span class="token operator">==</span> <span class="token string">'create'</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> OrderCommitSerializer
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> OrderDataSerializer
</code></pre></div><h2 id="_4-视图集的继承关系"><a href="#_4-视图集的继承关系" class="header-anchor">#</a> 4. 视图集的继承关系</h2> <p><img src="/image/drf/%E8%A7%86%E5%9B%BE%E9%9B%86%E7%B1%BB%E7%BB%A7%E6%89%BF%E5%85%B3%E7%B3%BB.png" alt="视图集类继承关系"></p> <h1 id="路由routers"><a href="#路由routers" class="header-anchor">#</a> 路由Routers</h1> <p>对于视图集ViewSet，我们除了可以自己手动指明请求方式与动作action之间的对应关系外，还可以使用Routers来帮助我们快速实现路由信息。</p> <p>REST framework提供了两个router</p> <ul><li><strong>SimpleRouter</strong></li> <li><strong>DefaultRouter</strong></li></ul> <h2 id="_1-使用方法"><a href="#_1-使用方法" class="header-anchor">#</a> 1. 使用方法</h2> <p>1） 创建router对象，并注册视图集，例如</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> routers

router <span class="token operator">=</span> routers<span class="token punctuation">.</span>SimpleRouter<span class="token punctuation">(</span><span class="token punctuation">)</span>
router<span class="token punctuation">.</span>register<span class="token punctuation">(</span><span class="token string">r'books'</span><span class="token punctuation">,</span> BookInfoViewSet<span class="token punctuation">,</span> base_name<span class="token operator">=</span><span class="token string">'book'</span><span class="token punctuation">)</span>
</code></pre></div><p>register(prefix, viewset, base_name)</p> <ul><li>prefix 该视图集的路由前缀</li> <li>viewset 视图集</li> <li>base_name 路由名称的前缀</li></ul> <p>如上述代码会形成的路由如下：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">^</span>books<span class="token operator">/</span>$    name<span class="token punctuation">:</span> book<span class="token operator">-</span><span class="token builtin">list</span>
<span class="token operator">^</span>books<span class="token operator">/</span><span class="token punctuation">{</span>pk<span class="token punctuation">}</span><span class="token operator">/</span>$   name<span class="token punctuation">:</span> book<span class="token operator">-</span>detail
</code></pre></div><p>2）添加路由数据</p> <p>可以有两种方式：</p> <div class="language-python extra-class"><pre class="language-python"><code>urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">]</span>
urlpatterns <span class="token operator">+=</span> router<span class="token punctuation">.</span>urls
</code></pre></div><p>或</p> <div class="language-python extra-class"><pre class="language-python"><code>urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    url<span class="token punctuation">(</span><span class="token string">r'^'</span><span class="token punctuation">,</span> include<span class="token punctuation">(</span>router<span class="token punctuation">.</span>urls<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre></div><h2 id="_2-视图集中附加action的声明"><a href="#_2-视图集中附加action的声明" class="header-anchor">#</a> 2. 视图集中附加action的声明</h2> <p>在视图集中，如果想要让Router自动帮助我们为自定义的动作生成路由信息，需要使用<code>rest_framework.decorators.action</code>装饰器。</p> <p>以action装饰器装饰的方法名会作为action动作名，与list、retrieve等同。</p> <p>action装饰器可以接收两个参数：</p> <ul><li><p><strong>methods</strong>: 声明该action对应的请求方式，列表传递</p></li> <li><p>detail</p> <p>: 声明该action的路径是否与单一资源对应，及是否是</p> <div class="language- extra-class"><pre class="language-text"><code>xxx/&lt;pk&gt;/action方法名/
</code></pre></div><ul><li>True 表示路径格式是<code>xxx/&lt;pk&gt;/action方法名/</code></li> <li>False 表示路径格式是<code>xxx/action方法名/</code></li></ul></li></ul> <p>举例：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> mixins
<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>viewsets <span class="token keyword">import</span> GenericViewSet
<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>decorators <span class="token keyword">import</span> action

<span class="token keyword">class</span> <span class="token class-name">BookInfoViewSet</span><span class="token punctuation">(</span>mixins<span class="token punctuation">.</span>ListModelMixin<span class="token punctuation">,</span> mixins<span class="token punctuation">.</span>RetrieveModelMixin<span class="token punctuation">,</span> GenericViewSet<span class="token punctuation">)</span><span class="token punctuation">:</span>
    queryset <span class="token operator">=</span> BookInfo<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    serializer_class <span class="token operator">=</span> BookInfoSerializer

    <span class="token comment"># detail为False 表示路径名格式应该为 books/latest/</span>
    <span class="token decorator annotation punctuation">@action</span><span class="token punctuation">(</span>methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'get'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> detail<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">latest</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        返回最新的图书信息
        &quot;&quot;&quot;</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

    <span class="token comment"># detail为True，表示路径名格式应该为 books/{pk}/read/</span>
    <span class="token decorator annotation punctuation">@action</span><span class="token punctuation">(</span>methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'put'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> detail<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">read</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> pk<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        修改图书的阅读量数据
        &quot;&quot;&quot;</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre></div><p>由路由器自动为此视图集自定义action方法形成的路由会是如下内容：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">^</span>books<span class="token operator">/</span>latest<span class="token operator">/</span>$    name<span class="token punctuation">:</span> book<span class="token operator">-</span>latest
<span class="token operator">^</span>books<span class="token operator">/</span><span class="token punctuation">{</span>pk<span class="token punctuation">}</span><span class="token operator">/</span>read<span class="token operator">/</span>$  name<span class="token punctuation">:</span> book<span class="token operator">-</span>read
</code></pre></div><h3 id="_3-路由router形成url的方式"><a href="#_3-路由router形成url的方式" class="header-anchor">#</a> 3. 路由router形成URL的方式</h3> <p>1） SimpleRouter</p> <p><img src="/image/drf/simple_router.png" alt="simple_router"></p> <p>2）DefaultRouter</p> <p><img src="/image/drf/default_router.png" alt="default_router"></p> <p>DefaultRouter与SimpleRouter的区别是，DefaultRouter会多附带一个默认的API根视图，返回一个包含所有列表视图的超链接响应数据。</p> <h1 id="认证authentication"><a href="#认证authentication" class="header-anchor">#</a> 认证Authentication</h1> <p>可以在配置文件中配置全局默认的认证方案</p> <p>一般配置为全局</p> <div class="language-python extra-class"><pre class="language-python"><code>REST_FRAMEWORK <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'DEFAULT_AUTHENTICATION_CLASSES'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>
        <span class="token string">'rest_framework.authentication.BasicAuthentication'</span><span class="token punctuation">,</span>   <span class="token comment"># 基本认证</span>
        <span class="token string">'rest_framework.authentication.SessionAuthentication'</span><span class="token punctuation">,</span>  <span class="token comment"># session认证</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>也可以在每个视图中通过设置authentication_classess属性来设置</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>authentication <span class="token keyword">import</span> SessionAuthentication<span class="token punctuation">,</span> BasicAuthentication
<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>views <span class="token keyword">import</span> APIView

<span class="token keyword">class</span> <span class="token class-name">ExampleView</span><span class="token punctuation">(</span>APIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    authentication_classes <span class="token operator">=</span> <span class="token punctuation">(</span>SessionAuthentication<span class="token punctuation">,</span> BasicAuthentication<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre></div><p>认证失败会有两种可能的返回值：</p> <ul><li>401 Unauthorized 未认证</li> <li>403 Permission Denied 权限被禁止</li></ul> <h1 id="权限permissions"><a href="#权限permissions" class="header-anchor">#</a> 权限Permissions</h1> <p>权限控制可以限制用户对于视图的访问和对于具体数据对象的访问。</p> <ul><li>在执行视图的dispatch()方法前，会先进行视图访问权限的判断</li> <li>在通过get_object()获取具体对象时，会进行对象访问权限的判断</li></ul> <h3 id="使用"><a href="#使用" class="header-anchor">#</a> 使用</h3> <p>可以在配置文件中设置默认的权限管理类，如</p> <div class="language-python extra-class"><pre class="language-python"><code>REST_FRAMEWORK <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'DEFAULT_PERMISSION_CLASSES'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>
        <span class="token string">'rest_framework.permissions.IsAuthenticated'</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如果未指明，则采用如下默认配置</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token string">'DEFAULT_PERMISSION_CLASSES'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>
   <span class="token string">'rest_framework.permissions.AllowAny'</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
</code></pre></div><p>也可以在具体的视图中通过permission_classes属性来设置，如</p> <p>一般设定为局部</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>permissions <span class="token keyword">import</span> IsAuthenticated
<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>views <span class="token keyword">import</span> APIView

<span class="token keyword">class</span> <span class="token class-name">ExampleView</span><span class="token punctuation">(</span>APIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    permission_classes <span class="token operator">=</span> <span class="token punctuation">(</span>IsAuthenticated<span class="token punctuation">,</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre></div><h3 id="提供的权限"><a href="#提供的权限" class="header-anchor">#</a> 提供的权限</h3> <ul><li>AllowAny 允许所有用户</li> <li>IsAuthenticated 仅通过认证的用户</li> <li>IsAdminUser 仅管理员用户</li> <li>IsAuthenticatedOrReadOnly 认证的用户可以完全操作，否则只能get读取</li></ul> <h3 id="举例"><a href="#举例" class="header-anchor">#</a> 举例</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>authentication <span class="token keyword">import</span> SessionAuthentication
<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>permissions <span class="token keyword">import</span> IsAuthenticated
<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>generics <span class="token keyword">import</span> RetrieveAPIView

<span class="token keyword">class</span> <span class="token class-name">BookDetailView</span><span class="token punctuation">(</span>RetrieveAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    queryset <span class="token operator">=</span> BookInfo<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    serializer_class <span class="token operator">=</span> BookInfoSerializer
    authentication_classes <span class="token operator">=</span> <span class="token punctuation">[</span>SessionAuthentication<span class="token punctuation">]</span>
    permission_classes <span class="token operator">=</span> <span class="token punctuation">[</span>IsAuthenticated<span class="token punctuation">]</span>
</code></pre></div><h3 id="自定义权限"><a href="#自定义权限" class="header-anchor">#</a> 自定义权限</h3> <p>如需自定义权限，需继承rest_framework.permissions.BasePermission父类，并实现以下两个任何一个方法或全部</p> <ul><li><p><code>.has_permission(self, request, view)</code></p> <p>是否可以访问视图， view表示当前视图对象</p></li> <li><p><code>.has_object_permission(self, request, view, obj)</code></p> <p>是否可以访问数据对象， view表示当前视图， obj为数据对象</p></li></ul> <p>例如：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">MyPermission</span><span class="token punctuation">(</span>BasePermission<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">has_object_permission</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> view<span class="token punctuation">,</span> obj<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;控制对obj对象的访问权限，此案例决绝所有对对象的访问&quot;&quot;&quot;</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>

<span class="token keyword">class</span> <span class="token class-name">BookInfoViewSet</span><span class="token punctuation">(</span>ModelViewSet<span class="token punctuation">)</span><span class="token punctuation">:</span>
    queryset <span class="token operator">=</span> BookInfo<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    serializer_class <span class="token operator">=</span> BookInfoSerializer
    permission_classes <span class="token operator">=</span> <span class="token punctuation">[</span>IsAuthenticated<span class="token punctuation">,</span> MyPermission<span class="token punctuation">]</span>
</code></pre></div><h1 id="限流throttling"><a href="#限流throttling" class="header-anchor">#</a> 限流Throttling</h1> <p>可以对接口访问的频次进行限制，以减轻服务器压力。</p> <h2 id="使用-2"><a href="#使用-2" class="header-anchor">#</a> 使用</h2> <p>可以在配置文件中，使用<code>DEFAULT_THROTTLE_CLASSES</code> 和 <code>DEFAULT_THROTTLE_RATES</code>进行全局配置，</p> <div class="language-python extra-class"><pre class="language-python"><code>REST_FRAMEWORK <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'DEFAULT_THROTTLE_CLASSES'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>
        <span class="token string">'rest_framework.throttling.AnonRateThrottle'</span><span class="token punctuation">,</span> <span class="token comment">#匿名用户</span>
        <span class="token string">'rest_framework.throttling.UserRateThrottle'</span><span class="token comment">#登录用户</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string">'DEFAULT_THROTTLE_RATES'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">'anon'</span><span class="token punctuation">:</span> <span class="token string">'100/day'</span><span class="token punctuation">,</span> <span class="token comment">#匿名用户频次</span>
        <span class="token string">'user'</span><span class="token punctuation">:</span> <span class="token string">'1000/day'</span><span class="token comment">#登录用户频次</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>DEFAULT_THROTTLE_RATES</code> 可以使用 <code>second</code>, <code>minute</code>, <code>hour</code> 或<code>day</code>来指明周期。</p> <p>也可以在具体视图中通过throttle_classess属性来配置，如</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>throttling <span class="token keyword">import</span> UserRateThrottle
<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>views <span class="token keyword">import</span> APIView

<span class="token keyword">class</span> <span class="token class-name">ExampleView</span><span class="token punctuation">(</span>APIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    throttle_classes <span class="token operator">=</span> <span class="token punctuation">(</span>UserRateThrottle<span class="token punctuation">,</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre></div><h3 id="可选限流类"><a href="#可选限流类" class="header-anchor">#</a> 可选限流类</h3> <p>1） AnonRateThrottle</p> <p>限制所有匿名未认证用户，使用IP区分用户。</p> <p>使用<code>DEFAULT_THROTTLE_RATES['anon']</code> 来设置频次</p> <p>2）UserRateThrottle</p> <p>限制认证用户，使用User id 来区分。</p> <p>使用<code>DEFAULT_THROTTLE_RATES['user']</code> 来设置频次</p> <p>3）ScopedRateThrottle</p> <p>限制用户对于每个视图的访问频次，使用ip或user id。</p> <p>例如：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">ContactListView</span><span class="token punctuation">(</span>APIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    throttle_scope <span class="token operator">=</span> <span class="token string">'contacts'</span> <span class="token comment">#自定义限流</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token keyword">class</span> <span class="token class-name">ContactDetailView</span><span class="token punctuation">(</span>APIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    throttle_scope <span class="token operator">=</span> <span class="token string">'contacts'</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token keyword">class</span> <span class="token class-name">UploadView</span><span class="token punctuation">(</span>APIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    throttle_scope <span class="token operator">=</span> <span class="token string">'uploads'</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
REST_FRAMEWORK <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'DEFAULT_THROTTLE_CLASSES'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>
        <span class="token string">'rest_framework.throttling.ScopedRateThrottle'</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string">'DEFAULT_THROTTLE_RATES'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">'contacts'</span><span class="token punctuation">:</span> <span class="token string">'1000/day'</span><span class="token punctuation">,</span>
        <span class="token string">'uploads'</span><span class="token punctuation">:</span> <span class="token string">'20/day'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="实例"><a href="#实例" class="header-anchor">#</a> 实例</h2> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>authentication <span class="token keyword">import</span> SessionAuthentication
<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>permissions <span class="token keyword">import</span> IsAuthenticated
<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>generics <span class="token keyword">import</span> RetrieveAPIView
<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>throttling <span class="token keyword">import</span> UserRateThrottle

<span class="token keyword">class</span> <span class="token class-name">BookDetailView</span><span class="token punctuation">(</span>RetrieveAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    queryset <span class="token operator">=</span> BookInfo<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    serializer_class <span class="token operator">=</span> BookInfoSerializer
    authentication_classes <span class="token operator">=</span> <span class="token punctuation">[</span>SessionAuthentication<span class="token punctuation">]</span>
    permission_classes <span class="token operator">=</span> <span class="token punctuation">[</span>IsAuthenticated<span class="token punctuation">]</span>
    throttle_classes <span class="token operator">=</span> <span class="token punctuation">(</span>UserRateThrottle<span class="token punctuation">,</span><span class="token punctuation">)</span>
</code></pre></div><h1 id="过滤filtering"><a href="#过滤filtering" class="header-anchor">#</a> 过滤Filtering</h1> <p>对于列表数据可能需要根据字段进行过滤，我们可以通过添加django-fitlter扩展来增强支持。</p> <div class="language-shel extra-class"><pre class="language-text"><code>pip install django-filter
</code></pre></div><p>在配置文件中增加过滤后端的设置：</p> <div class="language-python extra-class"><pre class="language-python"><code>INSTALLED_APPS <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token string">'django_filters'</span><span class="token punctuation">,</span>  <span class="token comment"># 需要注册应用，</span>
<span class="token punctuation">]</span>

REST_FRAMEWORK <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'DEFAULT_FILTER_BACKENDS'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token string">'django_filters.rest_framework.DjangoFilterBackend'</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在视图中添加filter_fields属性，指定可以过滤的字段</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">BookListView</span><span class="token punctuation">(</span>ListAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    queryset <span class="token operator">=</span> BookInfo<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    serializer_class <span class="token operator">=</span> BookInfoSerializer
    filter_fields <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'btitle'</span><span class="token punctuation">,</span> <span class="token string">'bread'</span><span class="token punctuation">)</span>

<span class="token comment"># 127.0.0.1:8000/books/?btitle=西游记</span>
</code></pre></div><h1 id="排序"><a href="#排序" class="header-anchor">#</a> 排序</h1> <p>对于列表数据，REST framework提供了<strong>OrderingFilter</strong>过滤器来帮助我们快速指明数据按照指定字段进行排序。</p> <h4 id="使用方法"><a href="#使用方法" class="header-anchor">#</a> 使用方法：</h4> <p>在类视图中设置filter_backends，使用<code>rest_framework.filters.OrderingFilter</code>过滤器，REST framework会在请求的查询字符串参数中检查是否包含了ordering参数，如果包含了ordering参数，则按照ordering参数指明的排序字段对数据集进行排序。</p> <p>前端可以传递的ordering参数的可选字段值需要在ordering_fields中指明。</p> <p>示例：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">BookListView</span><span class="token punctuation">(</span>ListAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    queryset <span class="token operator">=</span> BookInfo<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    serializer_class <span class="token operator">=</span> BookInfoSerializer
    filter_backends <span class="token operator">=</span> <span class="token punctuation">[</span>OrderingFilter<span class="token punctuation">]</span>
    ordering_fields <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span> <span class="token string">'bread'</span><span class="token punctuation">,</span> <span class="token string">'bpub_date'</span><span class="token punctuation">)</span>

<span class="token comment"># 127.0.0.1:8000/books/?ordering=-bread</span>
</code></pre></div><h1 id="分页pagination"><a href="#分页pagination" class="header-anchor">#</a> 分页Pagination</h1> <p>REST framework提供了分页的支持。</p> <p>我们可以在配置文件中设置全局的分页方式，如：</p> <div class="language-python extra-class"><pre class="language-python"><code>REST_FRAMEWORK <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'DEFAULT_PAGINATION_CLASS'</span><span class="token punctuation">:</span>  <span class="token string">'rest_framework.pagination.PageNumberPagination'</span><span class="token punctuation">,</span>
    <span class="token string">'PAGE_SIZE'</span><span class="token punctuation">:</span> <span class="token number">100</span>  <span class="token comment"># 每页数目</span>
<span class="token punctuation">}</span>
</code></pre></div><p>也可通过自定义Pagination类，来为视图添加不同分页行为。在视图中通过<code>pagination_clas</code>属性来指明。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">LargeResultsSetPagination</span><span class="token punctuation">(</span>PageNumberPagination<span class="token punctuation">)</span><span class="token punctuation">:</span>
    page_size <span class="token operator">=</span> <span class="token number">1000</span>
    page_size_query_param <span class="token operator">=</span> <span class="token string">'page_size'</span>
    max_page_size <span class="token operator">=</span> <span class="token number">10000</span>
<span class="token keyword">class</span> <span class="token class-name">BookDetailView</span><span class="token punctuation">(</span>RetrieveAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    queryset <span class="token operator">=</span> BookInfo<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    serializer_class <span class="token operator">=</span> BookInfoSerializer
    pagination_class <span class="token operator">=</span> LargeResultsSetPagination
</code></pre></div><p><strong>注意：如果在视图内关闭分页功能，只需在视图内设置</strong></p> <div class="language-python extra-class"><pre class="language-python"><code>pagination_class <span class="token operator">=</span> <span class="token boolean">None</span>
</code></pre></div><h2 id="可选分页器"><a href="#可选分页器" class="header-anchor">#</a> 可选分页器</h2> <p>1） <strong>PageNumberPagination</strong></p> <p>前端访问网址形式：</p> <div class="language-http extra-class"><pre class="language-http"><code>GET  http://api.example.org/books/?page=4
</code></pre></div><p>可以在子类中定义的属性：</p> <ul><li>page_size 每页数目</li> <li>page_query_param 前端发送的页数关键字名，默认为&quot;page&quot;</li> <li>page_size_query_param 前端发送的每页数目关键字名，默认为None</li> <li>max_page_size 前端最多能设置的每页数量</li></ul> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>pagination <span class="token keyword">import</span> PageNumberPagination

<span class="token keyword">class</span> <span class="token class-name">StandardPageNumberPagination</span><span class="token punctuation">(</span>PageNumberPagination<span class="token punctuation">)</span><span class="token punctuation">:</span>
    page_size_query_param <span class="token operator">=</span> <span class="token string">'page_size'</span>
    max_page_size <span class="token operator">=</span> <span class="token number">10</span>

<span class="token keyword">class</span> <span class="token class-name">BookListView</span><span class="token punctuation">(</span>ListAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    queryset <span class="token operator">=</span> BookInfo<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>order_by<span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span>
    serializer_class <span class="token operator">=</span> BookInfoSerializer
    pagination_class <span class="token operator">=</span> StandardPageNumberPagination

<span class="token comment"># 127.0.0.1/books/?page=1&amp;page_size=2</span>
</code></pre></div><p>2）<strong>LimitOffsetPagination</strong></p> <p>前端访问网址形式：</p> <div class="language-http extra-class"><pre class="language-http"><code>GET http://api.example.org/books/?limit=100&amp;offset=400
</code></pre></div><p>可以在子类中定义的属性：</p> <ul><li>default_limit 默认限制，默认值与<code>PAGE_SIZE</code>设置一直</li> <li>limit_query_param limit参数名，默认'limit'</li> <li>offset_query_param offset参数名，默认'offset'</li> <li>max_limit 最大limit限制，默认None</li></ul> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>pagination <span class="token keyword">import</span> LimitOffsetPagination

<span class="token keyword">class</span> <span class="token class-name">BookListView</span><span class="token punctuation">(</span>ListAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    queryset <span class="token operator">=</span> BookInfo<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>order_by<span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span>
    serializer_class <span class="token operator">=</span> BookInfoSerializer
    pagination_class <span class="token operator">=</span> LimitOffsetPagination

<span class="token comment"># 127.0.0.1:8000/books/?offset=3&amp;limit=2</span>
</code></pre></div><h1 id="异常处理-exceptions"><a href="#异常处理-exceptions" class="header-anchor">#</a> 异常处理 Exceptions</h1> <p>REST framework提供了异常处理，我们可以自定义异常处理函数。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>views <span class="token keyword">import</span> exception_handler

<span class="token keyword">def</span> <span class="token function">custom_exception_handler</span><span class="token punctuation">(</span>exc<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 先调用REST framework默认的异常处理方法获得标准错误响应对象</span>
    response <span class="token operator">=</span> exception_handler<span class="token punctuation">(</span>exc<span class="token punctuation">,</span> context<span class="token punctuation">)</span>

    <span class="token comment"># 在此处补充自定义的异常处理</span>
    <span class="token keyword">if</span> response <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        response<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token string">'status_code'</span><span class="token punctuation">]</span> <span class="token operator">=</span> response<span class="token punctuation">.</span>status_code

    <span class="token keyword">return</span> response
</code></pre></div><p>在配置文件中声明自定义的异常处理</p> <div class="language-python extra-class"><pre class="language-python"><code>REST_FRAMEWORK <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'EXCEPTION_HANDLER'</span><span class="token punctuation">:</span> <span class="token string">'my_project.my_app.utils.custom_exception_handler'</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如果未声明，会采用默认的方式，如下</p> <div class="language-python extra-class"><pre class="language-python"><code>REST_FRAMEWORK <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'EXCEPTION_HANDLER'</span><span class="token punctuation">:</span> <span class="token string">'rest_framework.views.exception_handler'</span>
<span class="token punctuation">}</span>
</code></pre></div><p>例如：</p> <p>补充上处理关于数据库的异常</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>views <span class="token keyword">import</span> exception_handler <span class="token keyword">as</span> drf_exception_handler
<span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> status
<span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> DatabaseError

<span class="token keyword">def</span> <span class="token function">exception_handler</span><span class="token punctuation">(</span>exc<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">:</span>
    response <span class="token operator">=</span> drf_exception_handler<span class="token punctuation">(</span>exc<span class="token punctuation">,</span> context<span class="token punctuation">)</span>

    <span class="token keyword">if</span> response <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        view <span class="token operator">=</span> context<span class="token punctuation">[</span><span class="token string">'view'</span><span class="token punctuation">]</span>
        <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>exc<span class="token punctuation">,</span> DatabaseError<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'[%s]: %s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>view<span class="token punctuation">,</span> exc<span class="token punctuation">)</span><span class="token punctuation">)</span>
            response <span class="token operator">=</span> Response<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'detail'</span><span class="token punctuation">:</span> <span class="token string">'服务器内部错误'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> status<span class="token operator">=</span>status<span class="token punctuation">.</span>HTTP_507_INSUFFICIENT_STORAGE<span class="token punctuation">)</span>

    <span class="token keyword">return</span> response
</code></pre></div><h3 id="rest-framework定义的异常"><a href="#rest-framework定义的异常" class="header-anchor">#</a> REST framework定义的异常</h3> <ul><li>APIException 所有异常的父类</li> <li>ParseError 解析错误</li> <li>AuthenticationFailed 认证失败</li> <li>NotAuthenticated 尚未认证</li> <li>PermissionDenied 权限决绝</li> <li>NotFound 未找到</li> <li>MethodNotAllowed 请求方式不支持</li> <li>NotAcceptable 要获取的数据格式不支持</li> <li>Throttled 超过限流次数</li> <li>ValidationError 校验失败</li></ul> <h1 id="自动生成接口文档"><a href="#自动生成接口文档" class="header-anchor">#</a> 自动生成接口文档</h1> <p>REST framework可以自动帮助我们生成接口文档。</p> <p>接口文档以网页的方式呈现。</p> <p>自动接口文档能生成的是继承自<code>APIView</code>及其子类的视图。</p> <h2 id="_1-安装依赖"><a href="#_1-安装依赖" class="header-anchor">#</a> 1. 安装依赖</h2> <p>REST framewrok生成接口文档需要<code>coreapi</code>库的支持。</p> <div class="language-python extra-class"><pre class="language-python"><code>pip install coreapi
</code></pre></div><h2 id="_2-设置接口文档访问路径"><a href="#_2-设置接口文档访问路径" class="header-anchor">#</a> 2. 设置接口文档访问路径</h2> <p>在总路由中添加接口文档路径。</p> <p>文档路由对应的视图配置为<code>rest_framework.documentation.include_docs_urls</code>，</p> <p>参数<code>title</code>为接口文档网站的标题。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>documentation <span class="token keyword">import</span> include_docs_urls

urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    url<span class="token punctuation">(</span><span class="token string">r'^docs/'</span><span class="token punctuation">,</span> include_docs_urls<span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">'My API title'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre></div><h2 id="_3-文档描述说明的定义位置"><a href="#_3-文档描述说明的定义位置" class="header-anchor">#</a> 3. 文档描述说明的定义位置</h2> <p>1） 单一方法的视图，可直接使用类视图的文档字符串，如</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">BookListView</span><span class="token punctuation">(</span>generics<span class="token punctuation">.</span>ListAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;
    返回所有图书信息.
    &quot;&quot;&quot;</span>
</code></pre></div><p>2）包含多个方法的视图，在类视图的文档字符串中，分开方法定义，如</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">BookListCreateView</span><span class="token punctuation">(</span>generics<span class="token punctuation">.</span>ListCreateAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;
    get:
    返回所有图书信息.

    post:
    新建图书.
    &quot;&quot;&quot;</span>
</code></pre></div><p>3）对于视图集ViewSet，仍在类视图的文档字符串中封开定义，但是应使用action名称区分，如</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">BookInfoViewSet</span><span class="token punctuation">(</span>mixins<span class="token punctuation">.</span>ListModelMixin<span class="token punctuation">,</span> mixins<span class="token punctuation">.</span>RetrieveModelMixin<span class="token punctuation">,</span> GenericViewSet<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;
    list:
    返回图书列表数据

    retrieve:
    返回图书详情数据

    latest:
    返回最新的图书数据

    read:
    修改图书的阅读量
    &quot;&quot;&quot;</span>
</code></pre></div><h2 id="_4-访问接口文档网页"><a href="#_4-访问接口文档网页" class="header-anchor">#</a> 4. 访问接口文档网页</h2> <p>浏览器访问 127.0.0.1:8000/docs/，即可看到自动生成的接口文档。</p> <p><img src="/image/drf/%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3%E7%BD%91%E9%A1%B5.png" alt="接口文档网页"></p> <h4 id="两点说明-2"><a href="#两点说明-2" class="header-anchor">#</a> 两点说明：</h4> <p>1） 视图集ViewSet中的retrieve名称，在接口文档网站中叫做read</p> <p>2）参数的Description需要在模型类或序列化器类的字段中以help_text选项定义，如：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">BookInfo</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    bread <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>default<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">'阅读量'</span><span class="token punctuation">,</span> help_text<span class="token operator">=</span><span class="token string">'阅读量'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre></div><p>或</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">BookReadSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>ModelSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        model <span class="token operator">=</span> BookInfo
        fields <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'bread'</span><span class="token punctuation">,</span> <span class="token punctuation">)</span>
        extra_kwargs <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">'bread'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
                <span class="token string">'required'</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span>
                <span class="token string">'help_text'</span><span class="token punctuation">:</span> <span class="token string">'阅读量'</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后更新时间:</span> <span class="time">10/2/2021, 4:37:42 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blogs/Django/" class="prev router-link-active">
        django
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.d3bb4dbb.js" defer></script><script src="/assets/js/2.e4f42491.js" defer></script><script src="/assets/js/13.6388755d.js" defer></script>
  </body>
</html>
